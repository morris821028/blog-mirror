<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="shortcut icon" href="/img/f.png">
  
  <title>UVa 12436 - Rip Van Winkle&#39;s Code | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="12345678910111213141516long long data[250001];void A( int st, int nd ) {    for( int i = st; i &lt;= nd; i++ ) data[i] = data[i] + (i - st + 1);}void B( int st, int nd ) {    for( int i = st; i &lt;=">
<meta property="og:type" content="article">
<meta property="og:title" content="UVa 12436 - Rip Van Winkle's Code">
<meta property="og:url" content="http://morris821028.github.io/2014/08/02/oj/uva/uva-12436/">
<meta property="og:site_name" content="Morris' Blog">
<meta property="og:description" content="12345678910111213141516long long data[250001];void A( int st, int nd ) {    for( int i = st; i &lt;= nd; i++ ) data[i] = data[i] + (i - st + 1);}void B( int st, int nd ) {    for( int i = st; i &lt;=">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="UVa 12436 - Rip Van Winkle's Code">
<meta name="twitter:description" content="12345678910111213141516long long data[250001];void A( int st, int nd ) {    for( int i = st; i &lt;= nd; i++ ) data[i] = data[i] + (i - st + 1);}void B( int st, int nd ) {    for( int i = st; i &lt;=">
<link rel="publisher" href="108158678174364350000">

  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
  <!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Can you find me ?</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          <section id="main"><article id="post-oj/uva/uva-12436" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/08/02/oj/uva/uva-12436/" class="article-date">
  <time datetime="2014-08-02T06:20:17.000Z" itemprop="datePublished">Aug 2 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      UVa 12436 - Rip Van Winkle&#39;s Code
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/08/02/oj/uva/uva-12436/" data-id="6tsku6wa4icqqzzx" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/08/02/oj/uva/uva-12436/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ST/">ST</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/線段樹/">線段樹</a></li></ul>

    </footer>
    <div class="article-entry " itemprop="articleBody">
      
          
        
          <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> data[<span class="number">250001</span>];</div><div class="line"></div><div class="line"><span class="keyword">void</span> A( <span class="keyword">int</span> st, <span class="keyword">int</span> nd ) {</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = st; i &lt;= nd; i++ ) data[i] = data[i] + (i - st + <span class="number">1</span>);</div><div class="line">}</div><div class="line"><span class="keyword">void</span> B( <span class="keyword">int</span> st, <span class="keyword">int</span> nd ) {</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = st; i &lt;= nd; i++ ) data[i] = data[i] + (nd - i + <span class="number">1</span>);</div><div class="line">}</div><div class="line"><span class="keyword">void</span> C( <span class="keyword">int</span> st, <span class="keyword">int</span> nd, <span class="keyword">int</span> x ) {</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = st; i &lt;= nd; i++ ) data[i] = x;</div><div class="line">}</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> S( <span class="keyword">int</span> st, <span class="keyword">int</span> nd ) {</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> res = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = st; i &lt;= nd; i++ ) res += data[i];</div><div class="line">    <span class="keyword">return</span> res;</div><div class="line">}</div></pre></td></tr></table></figure>

<h2 id="Input">Input</h2>
<p>The first line of input will contain T (≤ 4*105) denoting the number of operations. Each of the next T lines starts with a character (‘A’, ‘B’, ‘C’ or ‘S’), which indicates the type of operation. Character ‘A’, ‘B’ or ‘S’ will be followed by two integers, st and nd in the same line. Character ‘C’ is followed by three integers, st, nd and x. It’s assumed that, 1 ≤ st ≤ nd ≤ 250000 and -105 ≤ x ≤ 105. The meanings of these integers are explained by the code of Rip Van Winkle.</p>
<h2 id="Output">Output</h2>
<p>For each line starting with the character ‘S’, print S( st, nd ) as defined in the code. Dataset is huge, so use faster I/O methods.</p>
<h2 id="Sample_Input">Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="number">7</span></div><div class="line">A <span class="number">1</span> <span class="number">4</span></div><div class="line">B <span class="number">2</span> <span class="number">3</span></div><div class="line">S <span class="number">1</span> <span class="number">3</span></div><div class="line"><span class="keyword">C</span> <span class="number">3</span> <span class="number">4</span> -<span class="number">2</span></div><div class="line">S <span class="number">2</span> <span class="number">4</span></div><div class="line">B <span class="number">1</span> <span class="number">3</span></div><div class="line">S <span class="number">2</span> <span class="number">4</span></div></pre></td></tr></table></figure>

<p>Output for Sample Input</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">9</div><div class="line">0</div><div class="line">3</div></pre></td></tr></table></figure>

<h2 id="Solution">Solution</h2>
<p>紀錄該區間的首項和公差即可，保證公差可以疊加。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt; </span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;algorithm&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> MAXN 262144</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> MAXM 1048576 + 10 </span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</div><div class="line">LL sum[MAXM];</div><div class="line">LL preB[MAXM], preD[MAXM]; <span class="comment">// base, diff</span></div><div class="line">LL sufB[MAXM], sufD[MAXM];</div><div class="line">LL setB[MAXM], setD[MAXM];</div><div class="line"></div><div class="line"><span class="keyword">void</span> pushUp(<span class="keyword">int</span> k) {</div><div class="line">	sum[k] = sum[k&lt;&lt;<span class="number">1</span>] + sum[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</div><div class="line">}</div><div class="line"><span class="keyword">void</span> pushDown(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r) {</div><div class="line">	<span class="keyword">int</span> m = (l + r) /<span class="number">2</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">if</span>(setB[k]) {</div><div class="line">		setB[k&lt;&lt;<span class="number">1</span>] = <span class="number">1</span>, setD[k&lt;&lt;<span class="number">1</span>] = setD[k];</div><div class="line">		setB[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = <span class="number">1</span>, setD[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = setD[k];</div><div class="line">		preB[k&lt;&lt;<span class="number">1</span>] = preD[k&lt;&lt;<span class="number">1</span>] = sufB[k&lt;&lt;<span class="number">1</span>] = sufD[k&lt;&lt;<span class="number">1</span>] = <span class="number">0</span>;</div><div class="line">		preB[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = preD[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = sufB[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = sufD[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = <span class="number">0</span>;</div><div class="line">		sum[k&lt;&lt;<span class="number">1</span>] = (m - l + <span class="number">1</span>) * setD[k];</div><div class="line">		sum[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = (r - m) * setD[k];</div><div class="line">		setB[k] = setD[k] = <span class="number">0</span>;</div><div class="line">	}</div><div class="line">	<span class="keyword">if</span>(preB[k]) {</div><div class="line">		preB[k&lt;&lt;<span class="number">1</span>] += preB[k], preD[k&lt;&lt;<span class="number">1</span>] += preD[k];</div><div class="line">		preB[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] += preB[k] + preD[k] * (m - l + <span class="number">1</span>), preD[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] += preD[k];</div><div class="line">		sum[k&lt;&lt;<span class="number">1</span>] += (<span class="number">2</span> * preB[k] + (m - l) * preD[k]) * (m - l + <span class="number">1</span>)/<span class="number">2</span>;</div><div class="line">		sum[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] += (<span class="number">2</span> * preB[k] + (r - l + m + <span class="number">1</span> - l) * preD[k]) * (r - m)/<span class="number">2</span>;</div><div class="line">		preB[k] = preD[k] = <span class="number">0</span>;</div><div class="line">	}</div><div class="line">	<span class="keyword">if</span>(sufB[k]) {</div><div class="line">		sufB[k&lt;&lt;<span class="number">1</span>] += sufB[k] + (r - m) * sufD[k], sufD[k&lt;&lt;<span class="number">1</span>] += sufD[k];</div><div class="line">		sum[k&lt;&lt;<span class="number">1</span>] += (<span class="number">2</span> * sufB[k] + (r - m + r - l) * sufD[k]) * (m - l + <span class="number">1</span>)/<span class="number">2</span>;</div><div class="line">		sufB[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] += sufB[k], sufD[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] += sufD[k];</div><div class="line">		sum[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] += (<span class="number">2</span> * sufB[k] + (r - m - <span class="number">1</span>) * sufD[k]) * (r - m)/<span class="number">2</span>;</div><div class="line"><span class="comment">//		printf("[%d %d] suffix %lld %lld , = %lld %lld\n", l, r, sufB[k], sufD[k], sum[k&lt;&lt;1], sum[k&lt;&lt;1|1]);</span></div><div class="line">		sufB[k] = sufD[k] = <span class="number">0</span>;</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="keyword">void</span> modifyA(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x, <span class="keyword">int</span> y) {</div><div class="line">	<span class="keyword">if</span>(l &gt; r)	<span class="keyword">return</span>;</div><div class="line">	<span class="keyword">if</span>(x &lt;= l &amp;&amp; r &lt;= y)  {</div><div class="line">		preB[k] += l - x + <span class="number">1</span>, preD[k]++;</div><div class="line">		sum[k] += (LL)(<span class="number">2</span> * (l - x + <span class="number">1</span>) + r - l) * (r - l + <span class="number">1</span>)/<span class="number">2</span>;</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	}</div><div class="line">	pushDown(k, l, r);</div><div class="line">	<span class="keyword">int</span> m = (l+r) /<span class="number">2</span>;</div><div class="line">	<span class="keyword">if</span>(y &lt;= m)</div><div class="line">		modifyA(k&lt;&lt;<span class="number">1</span>, l, m, x, y);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(x &gt; m)</div><div class="line">		modifyA(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, x, y);</div><div class="line">	<span class="keyword">else</span> {</div><div class="line">		modifyA(k&lt;&lt;<span class="number">1</span>, l, m, x, y);</div><div class="line">		modifyA(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, x, y);</div><div class="line">	}</div><div class="line">	pushUp(k);</div><div class="line">}</div><div class="line"><span class="keyword">void</span> modifyB(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x, <span class="keyword">int</span> y) {</div><div class="line">	<span class="keyword">if</span>(l &gt; r)	<span class="keyword">return</span>;</div><div class="line">	pushDown(k, l, r);</div><div class="line">	<span class="keyword">if</span>(x &lt;= l &amp;&amp; r &lt;= y)  {</div><div class="line">		sufB[k] += y - r + <span class="number">1</span>, sufD[k]++;</div><div class="line">		sum[k] += (LL)(<span class="number">2</span> * (y - r + <span class="number">1</span>) + r - l) * (r - l + <span class="number">1</span>)/<span class="number">2</span>;</div><div class="line"><span class="comment">//		printf("BB [%d %d] %d\n", l, r, base);</span></div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	}</div><div class="line">	<span class="keyword">int</span> m = (l+r) /<span class="number">2</span>;</div><div class="line">	<span class="keyword">if</span>(y &lt;= m)</div><div class="line">		modifyB(k&lt;&lt;<span class="number">1</span>, l, m, x, y);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(x &gt; m)</div><div class="line">		modifyB(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, x, y);</div><div class="line">	<span class="keyword">else</span> {</div><div class="line">		modifyB(k&lt;&lt;<span class="number">1</span>, l, m, x, y);</div><div class="line">		modifyB(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, x, y);</div><div class="line">	}</div><div class="line">	pushUp(k);</div><div class="line">}</div><div class="line"><span class="keyword">void</span> modifyC(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> mm) {</div><div class="line">	<span class="keyword">if</span>(l &gt; r)	<span class="keyword">return</span>;</div><div class="line">	<span class="keyword">if</span>(x &lt;= l &amp;&amp; r &lt;= y)  {</div><div class="line">		setB[k] = <span class="number">1</span>, setD[k] = mm;</div><div class="line">		preB[k] = preD[k] = sufB[k] = sufD[k] = <span class="number">0</span>;</div><div class="line">		sum[k] = (LL)mm * (r - l + <span class="number">1</span>);</div><div class="line"><span class="comment">//		printf("CCCC [%d %d] %lld\n", l, r, sum[k]);</span></div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	}</div><div class="line">	pushDown(k, l, r);</div><div class="line">	<span class="keyword">int</span> m = (l+r) /<span class="number">2</span>;</div><div class="line">	<span class="keyword">if</span>(y &lt;= m)</div><div class="line">		modifyC(k&lt;&lt;<span class="number">1</span>, l, m, x, y, mm);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(x &gt; m)</div><div class="line">		modifyC(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, x, y, mm);</div><div class="line">	<span class="keyword">else</span> {</div><div class="line">		modifyC(k&lt;&lt;<span class="number">1</span>, l, m, x, y, mm);</div><div class="line">		modifyC(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, x, y, mm);</div><div class="line">	}</div><div class="line">	pushUp(k);</div><div class="line">}</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> query(<span class="keyword">int</span> k, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x, <span class="keyword">int</span> y) {</div><div class="line">	<span class="keyword">if</span>(l &gt; r)	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	pushDown(k, l, r);</div><div class="line">	<span class="keyword">if</span>(x &lt;= l &amp;&amp; r &lt;= y) {</div><div class="line"><span class="comment">//		printf("qq[%d %d] %lld\n", l, r, sum[k]);</span></div><div class="line">		<span class="keyword">return</span> sum[k];</div><div class="line">	}</div><div class="line">	<span class="keyword">int</span> m = (l + r)/<span class="number">2</span>;</div><div class="line">	<span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span>(x &lt;= m)</div><div class="line">		ret += query(k&lt;&lt;<span class="number">1</span>, l, m, x, y);</div><div class="line">	<span class="keyword">if</span>(y &gt; m)</div><div class="line">		ret += query(k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, m+<span class="number">1</span>, r, x, y);</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> main() {</div><div class="line"><span class="comment">//	freopen("in.txt", "r+t", stdin);</span></div><div class="line"><span class="comment">//	freopen("out2.txt", "w+t", stdout); </span></div><div class="line">	<span class="keyword">int</span> T, st, nd, x;</div><div class="line">	<span class="keyword">char</span> cmd[<span class="number">128</span>];</div><div class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T) == <span class="number">1</span>) {</div><div class="line">		<span class="built_in">memset</span>(sum, <span class="number">0</span>, <span class="keyword">sizeof</span>(sum));</div><div class="line">		<span class="built_in">memset</span>(preB, <span class="number">0</span>, <span class="keyword">sizeof</span>(preB));</div><div class="line">		<span class="built_in">memset</span>(preD, <span class="number">0</span>, <span class="keyword">sizeof</span>(preD));</div><div class="line">		<span class="built_in">memset</span>(sufB, <span class="number">0</span>, <span class="keyword">sizeof</span>(sufB));</div><div class="line">		<span class="built_in">memset</span>(sufD, <span class="number">0</span>, <span class="keyword">sizeof</span>(sufD));</div><div class="line">		<span class="built_in">memset</span>(setB, <span class="number">0</span>, <span class="keyword">sizeof</span>(setB));</div><div class="line">		<span class="built_in">memset</span>(setD, <span class="number">0</span>, <span class="keyword">sizeof</span>(setD));</div><div class="line">		<span class="keyword">while</span>(T--) {</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%s"</span>, cmd);</div><div class="line">			<span class="keyword">if</span>(cmd[<span class="number">0</span>] == <span class="string">'C'</span>)</div><div class="line">				<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;st, &amp;nd, &amp;x);</div><div class="line">			<span class="keyword">else</span></div><div class="line">				<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;st, &amp;nd);</div><div class="line">			<span class="keyword">switch</span>(cmd[<span class="number">0</span>]) {</div><div class="line">				<span class="keyword">case</span> <span class="string">'A'</span>:</div><div class="line">					modifyA(<span class="number">1</span>, <span class="number">1</span>, MAXN, st, nd);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				<span class="keyword">case</span> <span class="string">'B'</span>:</div><div class="line">					modifyB(<span class="number">1</span>, <span class="number">1</span>, MAXN, st, nd);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				<span class="keyword">case</span> <span class="string">'C'</span>:</div><div class="line">					modifyC(<span class="number">1</span>, <span class="number">1</span>, MAXN, st, nd, x);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				<span class="keyword">case</span> <span class="string">'S'</span>:</div><div class="line">					<span class="keyword">long</span> <span class="keyword">long</span> ret = query(<span class="number">1</span>, <span class="number">1</span>, MAXN, st, nd);</div><div class="line">					<span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ret);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">			}</div><div class="line">		} </div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="comment">/*</span></div><div class="line">1000</div><div class="line">S 2 3</div><div class="line">A 7 15</div><div class="line">B 4 5</div><div class="line">B 15 16</div><div class="line">C 2 10 3</div><div class="line">B 14 15</div><div class="line">A 10 18</div><div class="line">S 4 4</div><div class="line">A 3 16</div><div class="line">B 6 14</div><div class="line">B 4 7</div><div class="line">S 8 11</div><div class="line">*/</div></pre></td></tr></table></figure>
        
      
    </div>

  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/08/02/oj/uva/uva-12446/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          UVa 12446 - How Many... in 3D!
        
      </div>
    </a>
  
  
    <a href="/2014/08/02/oj/uva/uva-12396/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">UVa 12396 - Remoteland</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
          
            <aside id="sidebar">
  <div id="ukagaka_panel"></div>

  

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">46</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">14</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">449</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">409</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2015/04/20/2015-google-code-jam-1A/">
              
                <i class="icon-file-o"></i> 
              
            2015 Google Code Jam Round 1A</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1115/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1115 - Water Shortage</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1089/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1089 - Suffix-Replacement Grammars</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1084/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1084 - Deer-Proof Fence</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1080/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1080 - My Bad</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1078/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1078 - Steam Roller</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1076/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1076 - Password Suspects</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1063/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1063 - Marble Game</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1049/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1049 - Remember the A La Mode</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1048/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1048 - Low Cost Air Travel</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget widget-background1">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮神"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="#" title=""><i class="icon-github-alt"></i> Can you translate world for me ?</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
</aside>

          
            
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://plus.google.com/u/0/108158678174364359204" target="_blank" title="Google+"><i class="icon-google-plus-sign"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2015 Shiang-Yun Yang 
    </div>  

  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/picture" class="mobile-nav-link">Pictures</a>
  
    <a href="/works" class="mobile-nav-link">Works</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  var disqus_url = 'http://morris821028.github.io/2014/08/02/oj/uva/uva-12436/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/jquery.lazyload.js" type="text/javascript"></script>

<script src="/js/jquery.als-1.6.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="shortcut icon" href="/img/f.png">
  
  <title>Category: 解題區 | Morris&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ACMer NEET NCU UVa OJ">
<meta property="og:type" content="website">
<meta property="og:title" content="Morris' Blog">
<meta property="og:url" content="http://morris821028.github.io/categories/解題區/page/41/">
<meta property="og:site_name" content="Morris' Blog">
<meta property="og:description" content="ACMer NEET NCU UVa OJ">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Morris' Blog">
<meta name="twitter:description" content="ACMer NEET NCU UVa OJ">
<link rel="publisher" href="108158678174364350000">

  
    <link rel="alternative" href="/atom.xml" title="Morris&#39; Blog" type="application/atom+xml">
  
  
    <meta name="google-site-verification" content="5mRgj8NanEMpGZuNfHNJNmH90RgNlrnJXsFlTaKD6Gs" />
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <script src="/js/jquery-2.1.0.min.js"></script>
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
  <!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  <link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.5.1.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"><div id="banner-right"></div></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Morris&#39; Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Can you find me ?</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          
            <a class="main-nav-link" href="/"><i class=icon-home title='Home'></i></a>
          
        
          
            <a class="main-nav-link" href="/about"><i class=icon-user title='About'></i></a>
          
        
          
            <a class="main-nav-link" href="/archives"><i class=icon-archive title='Archives'></i></a>
          
        
          
            <a class="main-nav-link" href="/tags"><i class=icon-tags title='Tags'></i></a>
          
        
          
            <a class="main-nav-link" href="/picture"><i class=icon-camera title='Pictures'></i></a>
          
        
          
            <a class="main-nav-link" href="/works"><i class=icon-trophy title='Works'></i></a>
          
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://morris821028.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        
          <section id="main">
  
    <article id="post-oj/uva/uva-171" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/24/oj/uva/uva-171/" class="article-date">
  <time datetime="2014-06-24T09:08:12.000Z" itemprop="datePublished">Jun 24 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/24/oj/uva/uva-171/">UVa 171 - Car Trialling</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/24/oj/uva/uva-171/" data-id="9ptzrqhpcav354is" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/24/oj/uva/uva-171/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SLR/">SLR</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem">Problem</h2>
<p>Car trialling requires the following of carefully worded instructions. When setting a trial, the organiser places traps in the instructions to catch out the unwary.</p>
<p>Write a program to determine whether an instruction obeys the following rules, which are loosely based on real car trialling instructions. <strong> BOLD-TEXT </strong> indicates text as it appears in the instruction (case sensitive), <code>|</code> separates options of which exactly one must be chosen, and .. expands, so A..D is equivalent to A | B | C | D .</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="variable">instruction =</span> navigational | time-keeping | navigational AND time-keeping</div><div class="line"></div><div class="line"><span class="variable">navigational =</span> directional | navigational AND THEN directional</div><div class="line"></div><div class="line"><span class="variable">directional =</span> how direction | how direction where</div><div class="line"></div><div class="line"><span class="variable">how =</span> GO | GO when | KEEP</div><div class="line"></div><div class="line"><span class="variable">direction =</span> RIGHT | LEFT</div><div class="line"></div><div class="line"><span class="variable">when =</span> FIRST | SECOND | THIRD</div><div class="line"></div><div class="line"><span class="variable">where =</span> AT sign</div><div class="line"></div><div class="line"><span class="variable">sign =</span> <span class="string">"signwords"</span></div><div class="line"></div><div class="line"><span class="variable">signwords =</span> s-word | signwords s-word</div><div class="line"></div><div class="line"><span class="variable">s-word =</span> letter | s-word letter</div><div class="line"></div><div class="line"><span class="variable">letter =</span> A..Z | .</div><div class="line"></div><div class="line"><span class="variable">time-keeping =</span> record tex2html_wrap_inline61 change</div><div class="line"></div><div class="line"><span class="variable">record =</span> RECORD TIME</div><div class="line"></div><div class="line"><span class="variable">change =</span> cas TO nnn KMH</div><div class="line"></div><div class="line"><span class="variable">cas =</span> CHANGE AVERAGE SPEED | CAS</div><div class="line"></div><div class="line"><span class="variable">nnn =</span> digit | nnn digit</div></pre></td></tr></table></figure>

<p>digit = 0..9 Note that s-word and nnn are sequences of letters and digits respectively, with no intervening spaces. There will be one or more spaces between items except before a period (.), after the opening speech marks or before the closing speech marks.</p>
<h2 id="Input">Input</h2>
<p>Each input line will consist of not more than 75 characters. The input will be terminated by a line consisting of a single #.</p>
<h2 id="Output">Output</h2>
<p>The output will consist of a series of sequentially numbered lines, either containing the valid instruction, or the text Trap! if the line did not obey the rules. The line number will be right justified in a field of 3 characters, followed by a full-stop, a single space, and the instruction, with sequences of more than one space reduced to single spaces.</p>
<h2 id="Sample_input">Sample input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">KEEP <span class="attribute">LEFT</span> AND THEN GO <span class="attribute">RIGHT</span></div><div class="line">CAS TO 20 KMH</div><div class="line">GO FIRST       <span class="attribute">RIGHT</span> AT "SMITH ST."  AND   CAS TO 20 KMH</div><div class="line">GO 2nd <span class="attribute">RIGHT</span></div><div class="line">GO <span class="attribute">LEFT</span> AT "SMITH STREET AND RECORD <span class="tag">TIME</span></div><div class="line">KEEP <span class="attribute">RIGHT</span> AND THEN RECORD <span class="tag">TIME</span></div><div class="line">#</div></pre></td></tr></table></figure>

<h2 id="Sample_output">Sample output</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span> KEEP <span class="keyword">LEFT</span> <span class="keyword">AND</span> <span class="keyword">THEN</span> GO <span class="keyword">RIGHT</span></div><div class="line"><span class="number">2.</span> CAS <span class="keyword">TO</span> <span class="number">20</span> KMH</div><div class="line"><span class="number">3.</span> GO FIRST <span class="keyword">RIGHT</span> AT <span class="string">"SMITH ST."</span> <span class="keyword">AND</span> CAS <span class="keyword">TO</span> <span class="number">20</span> KMH</div><div class="line"><span class="number">4.</span> Trap!</div><div class="line"><span class="number">5.</span> Trap!</div><div class="line"><span class="number">6.</span> Trap!</div></pre></td></tr></table></figure>

<h2 id="Solution">Solution</h2>
<p><strong> 題目描述： </strong></p>
<p>根據題目給定的規則，將汽車引領的命令句子做合法語句判斷。</p>
<p><strong> 題目解法： </strong></p>
<p>根據編譯器的方式，採用 LL(1) 修改題目給定的規則後，要進行建表，但是發現有幾處無法排除的語法規則，之後採用 SLR(1) 來完成。</p>
<p>SLR(1) 是由 LR(0) 加上 follow set 完成。</p>
<p>詳細的運作過程請詳見 wiki 說明，或者是修編譯器。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">There will be <span class="constant">one</span> <span class="operator">or</span> more spaces between <span class="keyword">items</span> except <span class="keyword">before</span> <span class="operator">a</span> period (.), <span class="keyword">after</span> <span class="operator">the</span> opening speech marks <span class="operator">or</span> <span class="keyword">before</span> <span class="operator">the</span> closing speech marks.</div></pre></td></tr></table></figure>

<p>本題最邪惡的地方在這裡，句號（.）前不可以用空白，前雙引號後不可有空白、後雙引號前不可以有空白。</p>
<p>雖然題目有包含這些 token 的語法產生，但還是用最暴力的方式將句子做基礎的 token 切割。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt; </span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;sstream&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;map&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;set&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;queue&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stack&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;ctype.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;assert.h&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> HTMLProduction</span></div><div class="line"><span class="comment">// #define DEBUG</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Production {</div><div class="line">	<span class="keyword">public</span>:</div><div class="line">		<span class="keyword">int</span> 			label;</div><div class="line">		<span class="built_in">string</span> 			LHS;</div><div class="line">		<span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span> 	RHS;</div><div class="line">		</div><div class="line">		Production(<span class="built_in">string</span> L = <span class="string">""</span>, <span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span> R = <span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span>(), <span class="keyword">int</span> l=<span class="number">0</span>) {</div><div class="line">			LHS = L;</div><div class="line">			RHS = R;</div><div class="line">			label = l;</div><div class="line">		}</div><div class="line"></div><div class="line">		<span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Production &p) <span class="keyword">const</span> {</div><div class="line">			<span class="keyword">if</span>(LHS != p.LHS)</div><div class="line">				<span class="keyword">return</span> LHS &lt; p.LHS;</div><div class="line">			<span class="keyword">for</span>(size_t i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; RHS.size() && j &lt; p.RHS.size(); i++, j++) {</div><div class="line">				<span class="keyword">if</span>(RHS[i] != p.RHS[i])</div><div class="line">					<span class="keyword">return</span> RHS[i] &lt; p.RHS[i];</div><div class="line">			}</div><div class="line">			<span class="keyword">return</span> RHS.size() &lt; p.RHS.size();</div><div class="line">		}</div><div class="line">		</div><div class="line">		<span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> Production &p) <span class="keyword">const</span> {</div><div class="line">			<span class="keyword">if</span>(LHS != p.LHS || RHS.size() != p.RHS.size())</div><div class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">			<span class="keyword">for</span>(size_t i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; RHS.size(); i++, j++) {</div><div class="line">				<span class="keyword">if</span>(RHS[i] != p.RHS[i])</div><div class="line">					<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">			}</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		}</div><div class="line">		</div><div class="line">		<span class="keyword">bool</span> <span class="keyword">operator</span>!=(<span class="keyword">const</span> Production &p) <span class="keyword">const</span> {</div><div class="line">			<span class="keyword">return</span> !(*<span class="keyword">this</span> == p);</div><div class="line">		}</div><div class="line">		</div><div class="line">		<span class="keyword">void</span> print() {</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%s -&gt; "</span>, LHS.c_str());</div><div class="line">			<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; RHS.size(); i++)</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%s"</span>, RHS[i].c_str());</div><div class="line">		}</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class</span> Grammar {</div><div class="line">	<span class="keyword">public</span>:</div><div class="line">		<span class="comment">/* LR parsing */</span></div><div class="line">		<span class="keyword">class</span> ConfigurationSet {</div><div class="line">			<span class="keyword">public</span>:</div><div class="line">				<span class="keyword">class</span> State {</div><div class="line">					<span class="keyword">public</span>:</div><div class="line">						<span class="keyword">int</span> dot;</div><div class="line">						<span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span> lookahead;</div><div class="line">						</div><div class="line">						State(<span class="keyword">int</span> d=<span class="number">0</span>, <span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span> l=<span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span>()):</div><div class="line">							dot(d), lookahead(l) {}</div><div class="line">						<span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> State &x) <span class="keyword">const</span> {</div><div class="line">							<span class="keyword">return</span> dot &lt; x.dot;</div><div class="line">						}</div><div class="line">						<span class="keyword">bool</span> <span class="keyword">operator</span>!=(<span class="keyword">const</span> State &x) <span class="keyword">const</span> {</div><div class="line">							<span class="keyword">return</span> dot != x.dot;</div><div class="line">						}</div><div class="line">				};</div><div class="line">				</div><div class="line">				<span class="stl_container"><span class="built_in">set</span>&lt; pair&lt;Production, State&gt;</span> &gt; 	configs;</div><div class="line">				<span class="keyword">int</span> 							label;</div><div class="line">				ConfigurationSet() {</div><div class="line">					label = <span class="number">0</span>;</div><div class="line">				}</div><div class="line">				<span class="comment">/* method */</span></div><div class="line">				<span class="keyword">static</span> ConfigurationSet closure0(ConfigurationSet& s, Grammar& g);</div><div class="line">				<span class="keyword">static</span> ConfigurationSet go_to0(ConfigurationSet& s, <span class="built_in">string</span> X, Grammar& g);</div><div class="line">				<span class="keyword">void</span> print(Grammar &g) {</div><div class="line">					<span class="stl_container"><span class="built_in">set</span>&lt; pair&lt;Production, State&gt;</span> &gt;::iterator it;</div><div class="line">					Production p;</div><div class="line">					</div><div class="line">					<span class="keyword">for</span>(it = configs.begin(); it != configs.end(); it++) {</div><div class="line">						p = it-&gt;first;</div><div class="line">						<span class="built_in">printf</span>(<span class="string">"%s -&gt;"</span>, p.LHS.c_str());</div><div class="line">						<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; p.RHS.size(); i++) {</div><div class="line">							<span class="keyword">if</span>(i == it-&gt;second.dot)</div><div class="line">								<span class="built_in">printf</span>(<span class="string">"¡E"</span>);</div><div class="line">							<span class="built_in">printf</span>(<span class="string">" %s "</span>, p.RHS[i].c_str());</div><div class="line">						}</div><div class="line">						<span class="keyword">if</span>(it-&gt;second.dot == p.RHS.size())</div><div class="line">							<span class="built_in">printf</span>(<span class="string">"¡E"</span>);</div><div class="line">						<span class="built_in">printf</span>(<span class="string">" ,{"</span>);</div><div class="line">						<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> fset = g.follow_set[p.LHS];</div><div class="line">						<span class="keyword">for</span>(<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span>::iterator jt = fset.begin();</div><div class="line">							jt != fset.end(); jt++) {</div><div class="line">							<span class="keyword">if</span>(jt != fset.begin())</div><div class="line">								<span class="built_in">cout</span> &lt;&lt; <span class="string">", "</span>;</div><div class="line">							<span class="built_in">cout</span> &lt;&lt; *jt;</div><div class="line">						}</div><div class="line">						<span class="built_in">printf</span>(<span class="string">"}"</span>);</div><div class="line">						<span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">					}</div><div class="line">				}</div><div class="line">				<span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> ConfigurationSet &x) <span class="keyword">const</span> {</div><div class="line">					<span class="keyword">if</span>(configs.size() != x.configs.size())</div><div class="line">						<span class="keyword">return</span> configs.size() &lt; x.configs.size();</div><div class="line">					<span class="keyword">for</span>(<span class="stl_container"><span class="built_in">set</span>&lt; pair&lt;Production, State&gt;</span> &gt;::iterator it = configs.begin(), jt = x.configs.begin();</div><div class="line">						it != configs.end(); it++, jt++) {</div><div class="line">						<span class="keyword">if</span>(it-&gt;first != jt-&gt;first)</div><div class="line">							<span class="keyword">return</span> it-&gt;first &lt; jt-&gt;first;</div><div class="line">						<span class="keyword">if</span>(it-&gt;second != jt-&gt;second)</div><div class="line">							<span class="keyword">return</span> it-&gt;second &lt; jt-&gt;second;</div><div class="line">					}</div><div class="line">					<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">					<span class="comment">// return label &lt; x.label;</span></div><div class="line">				}</div><div class="line">		};		</div><div class="line">		</div><div class="line">		<span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">string</span> 		lambda;</div><div class="line">		<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span>					symbols;</div><div class="line">		<span class="built_in">string</span> 						start_symbol;</div><div class="line">		<span class="stl_container"><span class="built_in">vector</span>&lt;Production&gt;</span> 			rules;</div><div class="line">		<span class="comment">/* LL(1) attribute */</span></div><div class="line">		<span class="stl_container"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> &gt;</span> 	first_set;</div><div class="line">		<span class="stl_container"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> &gt;</span> 	follow_set;</div><div class="line">		<span class="stl_container"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">bool</span>&gt;</span> 			derives_lambda;</div><div class="line">		<span class="stl_container"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="stl_container"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, Production&gt;</span> &gt;</span>	lltable;</div><div class="line">		<span class="comment">/* LR attribute */</span></div><div class="line">		<span class="stl_container"><span class="built_in">vector</span>&lt;ConfigurationSet&gt;</span>	LRstates;</div><div class="line">		<span class="stl_container"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="stl_container"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt;</span> &gt;</span>	go_to_table;</div><div class="line">		<span class="stl_container"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;</span>				action_table;</div><div class="line">		</div><div class="line">		<span class="comment">/* common method */</span></div><div class="line">		<span class="keyword">static</span> <span class="keyword">bool</span> isNonterminal(<span class="built_in">string</span> token);</div><div class="line">		<span class="keyword">void</span> buildSymbols();</div><div class="line">		<span class="comment">/* LL(1) method */</span></div><div class="line">		<span class="stl_container"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">bool</span>&gt;</span> mark_lambda();</div><div class="line">		<span class="keyword">void</span> fill_first_set();</div><div class="line">		<span class="keyword">void</span> fill_follow_set();</div><div class="line">		<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> compute_first(<span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span> rhs);</div><div class="line">		<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> get_predict_set(Production p);</div><div class="line">		<span class="keyword">void</span> fill_lltable();</div><div class="line">		<span class="keyword">void</span> lldriver(<span class="stl_container"><span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt;</span> tokens);</div><div class="line">		<span class="comment">/* LR method*/</span></div><div class="line">		<span class="keyword">void</span> build_CFSM();</div><div class="line">		<span class="keyword">void</span> build_action();</div><div class="line">		<span class="keyword">void</span> lr0driver(<span class="stl_container"><span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt;</span> tokens);</div><div class="line">		<span class="keyword">int</span> slr1driver(<span class="stl_container"><span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt;</span> tokens);</div><div class="line">		<span class="keyword">void</span> lalr1driver(<span class="stl_container"><span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt;</span> tokens);</div><div class="line">		<span class="comment">/* homework */</span></div><div class="line">		<span class="keyword">void</span> hw_build_CFSM();</div><div class="line">};</div><div class="line"><span class="comment">/* ------------------------</span></div><div class="line">ConfigurationSet method</div><div class="line">-------------------------- */</div><div class="line">Grammar::ConfigurationSet Grammar::ConfigurationSet::closure0(ConfigurationSet& s, Grammar& g) {</div><div class="line">	ConfigurationSet 	r = s;</div><div class="line">	<span class="keyword">bool</span>				changes;</div><div class="line">	<span class="built_in">string</span>				A;</div><div class="line">	Production			P;</div><div class="line">	<span class="keyword">int</span> 				dotPos;</div><div class="line">	</div><div class="line">	<span class="stl_container"><span class="built_in">set</span>&lt; pair&lt;Production, State&gt;</span> &gt;::iterator it;</div><div class="line">	<span class="keyword">do</span> {</div><div class="line">		changes = <span class="keyword">false</span>;</div><div class="line">		<span class="keyword">for</span>(it = r.configs.begin(); it != r.configs.end(); it++) {</div><div class="line">			P = it-&gt;first;</div><div class="line">			dotPos = it-&gt;second.dot;</div><div class="line">			<span class="keyword">if</span>(dotPos &gt;= P.RHS.size() || P.RHS[dotPos] == Grammar::lambda)</div><div class="line">				<span class="keyword">continue</span>;</div><div class="line">			A = P.RHS[dotPos];</div><div class="line">			<span class="keyword">if</span>(Grammar::isNonterminal(A)) {</div><div class="line">				<span class="comment">/* B -&gt; x.Ay */</span></div><div class="line">				<span class="comment">/* Predict productions with A as the left-hand side */</span></div><div class="line">				<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; g.rules.size(); i++) {</div><div class="line">					<span class="keyword">if</span>(g.rules[i].LHS == A) {</div><div class="line">						<span class="keyword">if</span>(r.configs.find(make_pair(g.rules[i], State(<span class="number">0</span>))) == r.configs.end()) {</div><div class="line">							r.configs.insert(make_pair(g.rules[i], State(<span class="number">0</span>)));</div><div class="line">							changes = <span class="keyword">true</span>;</div><div class="line">						}</div><div class="line">					}</div><div class="line">				}</div><div class="line">			}</div><div class="line">		}</div><div class="line">	} <span class="keyword">while</span>(changes);</div><div class="line">	<span class="keyword">return</span> r;</div><div class="line">}</div><div class="line">Grammar::ConfigurationSet Grammar::ConfigurationSet::go_to0(ConfigurationSet& s, <span class="built_in">string</span> X, Grammar& g) {</div><div class="line">	ConfigurationSet sb;</div><div class="line">	<span class="stl_container"><span class="built_in">set</span>&lt; pair&lt;Production, State&gt;</span> &gt;::iterator it;</div><div class="line">	Production 	P;</div><div class="line">	<span class="keyword">int</span> 		dotPos;</div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(it = s.configs.begin(); it != s.configs.end(); it++) {</div><div class="line">		P = it-&gt;first;</div><div class="line">		dotPos = it-&gt;second.dot;</div><div class="line">		<span class="keyword">if</span>(dotPos &gt;= P.RHS.size() || P.RHS[dotPos] == Grammar::lambda)</div><div class="line">			<span class="keyword">continue</span>;</div><div class="line">		<span class="keyword">if</span>(P.RHS[dotPos] == X) {</div><div class="line">			State state(dotPos + <span class="number">1</span>, it-&gt;second.lookahead);</div><div class="line">			sb.configs.insert(make_pair(P, state));</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> closure0(sb, g);</div><div class="line">}</div><div class="line"><span class="comment">/* ------------------------</span></div><div class="line">Grammar method</div><div class="line">-------------------------- */</div><div class="line"><span class="keyword">const</span> <span class="built_in">string</span> Grammar::lambda(<span class="string">"l"</span>);</div><div class="line"></div><div class="line"><span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> Grammar::compute_first(<span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span> rhs) {</div><div class="line">	<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> result;</div><div class="line">	size_t 		i;</div><div class="line">	</div><div class="line">	<span class="keyword">if</span>(rhs.size() == <span class="number">0</span> || rhs[<span class="number">0</span>] == Grammar::lambda) {</div><div class="line">		result.insert(Grammar::lambda);</div><div class="line">	} <span class="keyword">else</span> {</div><div class="line">		result = first_set[rhs[<span class="number">0</span>]];</div><div class="line">		<span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; rhs.size() && </div><div class="line">			first_set[rhs[i-<span class="number">1</span>]].find(Grammar::lambda) != first_set[rhs[i-<span class="number">1</span>]].end(); i++) {</div><div class="line">			<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> f = first_set[rhs[i]];</div><div class="line">			f.erase(Grammar::lambda);</div><div class="line">			result.insert(f.begin(), f.end());	</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span>(i == rhs.size() </div><div class="line">			&& first_set[rhs[i-<span class="number">1</span>]].find(Grammar::lambda) != first_set[rhs[i-<span class="number">1</span>]].end()) {</div><div class="line">			result.insert(Grammar::lambda);</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			result.erase(Grammar::lambda);</div><div class="line">		}</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">} </div><div class="line"><span class="comment">/*</span></div><div class="line"> * please call get_predict_set() after fill_follow_set() and fill_first_set()</div><div class="line"> */</div><div class="line"><span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> Grammar::get_predict_set(Production p) {</div><div class="line">	<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> result;</div><div class="line">	<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> rfirst;</div><div class="line">	</div><div class="line">	rfirst = compute_first(p.RHS);</div><div class="line">	<span class="keyword">if</span>(rfirst.find(Grammar::lambda) != rfirst.end()) {</div><div class="line">		rfirst.erase(Grammar::lambda);</div><div class="line">		result.insert(rfirst.begin(), rfirst.end());</div><div class="line">		rfirst = follow_set[p.LHS];</div><div class="line">		result.insert(rfirst.begin(), rfirst.end());</div><div class="line">	} <span class="keyword">else</span> {</div><div class="line">		result.insert(rfirst.begin(), rfirst.end());</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">}</div><div class="line"><span class="comment">/*</span></div><div class="line"> * </div><div class="line"> */</div><div class="line"><span class="keyword">void</span> Grammar::fill_lltable() {</div><div class="line">	<span class="built_in">string</span>		A; <span class="comment">// nonterminal</span></div><div class="line">	Production 	p;</div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; rules.size(); i++) {</div><div class="line">		p = rules[i];</div><div class="line">		A = p.LHS;</div><div class="line">		<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> predict_set = get_predict_set(p);</div><div class="line">		</div><div class="line">		<span class="keyword">for</span>(<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span>::iterator it = predict_set.begin();</div><div class="line">			it != predict_set.end(); it++) {</div><div class="line">			assert(lltable[A].find(*it) == lltable[A].end());</div><div class="line">			lltable[A][*it] = p;</div><div class="line">		}</div><div class="line">	}</div><div class="line">	</div><div class="line">}</div><div class="line"><span class="keyword">void</span> Grammar::buildSymbols() {</div><div class="line">	symbols.clear();</div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; rules.size(); i++) {</div><div class="line">		symbols.insert(rules[i].LHS);</div><div class="line">		<span class="keyword">for</span>(size_t j = <span class="number">0</span>; j &lt; rules[i].RHS.size(); j++) {</div><div class="line">			symbols.insert(rules[i].RHS[j]);</div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="keyword">bool</span> Grammar::isNonterminal(<span class="built_in">string</span> token) {</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef HTMLProduction</span></div><div class="line">	<span class="keyword">if</span>(token == Grammar::lambda)</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	<span class="keyword">if</span>(token[<span class="number">0</span>] == <span class="string">'&lt;'</span> && token[token.length() - <span class="number">1</span>] == <span class="string">'&gt;'</span>)</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line"><span class="preprocessor">#<span class="keyword">else</span></span></div><div class="line">	<span class="keyword">if</span>(token == Grammar::lambda)</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; token.length(); i++) {</div><div class="line">		<span class="keyword">if</span>(<span class="built_in">isupper</span>(token[i]))</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line">}</div><div class="line"><span class="comment">/* ------------------------</span></div><div class="line">Grammar LL method</div><div class="line">-------------------------- */</div><div class="line"><span class="stl_container"><span class="built_in">map</span>&lt;<span class="built_in">string</span>, <span class="keyword">bool</span>&gt;</span> Grammar::mark_lambda() {</div><div class="line">	<span class="keyword">bool</span> 				rhs_derives_lambda;</div><div class="line">	<span class="keyword">bool</span> 				changes;</div><div class="line">	Production 			p;</div><div class="line">	</div><div class="line">	derives_lambda.clear();</div><div class="line">	</div><div class="line">	<span class="comment">/* initially, nothing is marked. */</span></div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; rules.size(); i++) {</div><div class="line">		derives_lambda[rules[i].LHS] = <span class="keyword">false</span>;</div><div class="line">	}</div><div class="line">	<span class="keyword">do</span> {</div><div class="line">		changes = <span class="keyword">false</span>;</div><div class="line">		<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; rules.size(); i++) {</div><div class="line">			p = rules[i];</div><div class="line">			<span class="keyword">if</span>(!derives_lambda[p.LHS]) {</div><div class="line">				<span class="keyword">if</span>(p.RHS.size() == <span class="number">0</span> || p.RHS[<span class="number">0</span>] == Grammar::lambda) {</div><div class="line">					changes = derives_lambda[p.LHS] = <span class="keyword">true</span>;</div><div class="line">					<span class="keyword">continue</span>;</div><div class="line">				}</div><div class="line">				<span class="comment">/* does each part of RHS derive lambda ? */</span></div><div class="line">				rhs_derives_lambda = derives_lambda[<span class="built_in">string</span>(p.RHS[<span class="number">0</span>])];</div><div class="line">				<span class="keyword">for</span>(size_t j = <span class="number">1</span>; j &lt; p.RHS.size(); j++) {</div><div class="line">					rhs_derives_lambda &= derives_lambda[p.RHS[j]];</div><div class="line">				}</div><div class="line">				<span class="keyword">if</span>(rhs_derives_lambda) {</div><div class="line">					changes = <span class="keyword">true</span>;</div><div class="line">					derives_lambda[p.LHS] = <span class="keyword">true</span>;</div><div class="line">				}</div><div class="line">			}</div><div class="line">		}</div><div class="line">	} <span class="keyword">while</span>(changes);</div><div class="line">	<span class="keyword">return</span> derives_lambda;</div><div class="line">}</div><div class="line"><span class="keyword">void</span> Grammar::fill_first_set() {</div><div class="line">	</div><div class="line">	<span class="built_in">string</span> 		A; <span class="comment">// nonterminal</span></div><div class="line">	<span class="built_in">string</span> 		a; <span class="comment">// terminal</span></div><div class="line">	Production 	p;</div><div class="line">	<span class="keyword">bool</span> 		changes;</div><div class="line">		</div><div class="line">	mark_lambda();</div><div class="line">	first_set.clear();</div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; rules.size(); i++) {</div><div class="line">		A = rules[i].LHS;</div><div class="line">		<span class="keyword">if</span>(derives_lambda[A])</div><div class="line">			first_set[A].insert(Grammar::lambda);</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; rules.size(); i++) {</div><div class="line">		<span class="keyword">for</span>(size_t j = <span class="number">0</span>; j &lt; rules[i].RHS.size(); j++) {</div><div class="line">			a = rules[i].RHS[j];</div><div class="line">			<span class="keyword">if</span>(!isNonterminal(a)) {</div><div class="line">				<span class="keyword">if</span>(a != Grammar::lambda)</div><div class="line">					first_set[a].insert(a);</div><div class="line">				<span class="keyword">if</span>(j == <span class="number">0</span>) { <span class="comment">// A -&gt; aXX</span></div><div class="line">					first_set[rules[i].LHS].insert(a);</div><div class="line">				}</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">	</div><div class="line">	<span class="keyword">do</span> {</div><div class="line">		changes = <span class="keyword">false</span>;</div><div class="line">		<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; rules.size(); i++) {</div><div class="line">			p = rules[i];</div><div class="line">			<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> rfirst = compute_first(p.RHS);</div><div class="line">			size_t oldsize = first_set[p.LHS].size();</div><div class="line">			first_set[p.LHS].insert(rfirst.begin(), rfirst.end());</div><div class="line">			size_t newsize = first_set[p.LHS].size();</div><div class="line">			<span class="keyword">if</span>(oldsize != newsize)</div><div class="line">				changes = <span class="keyword">true</span>;</div><div class="line">		}</div><div class="line">	} <span class="keyword">while</span>(changes);</div><div class="line">} </div><div class="line"></div><div class="line"><span class="keyword">void</span> Grammar::fill_follow_set() {</div><div class="line">	<span class="built_in">string</span> 	A, B; <span class="comment">// nonterminal</span></div><div class="line">	Production 	p;</div><div class="line">	<span class="keyword">bool</span> 	changes;</div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; rules.size(); i++) {</div><div class="line">		A = rules[i].LHS;</div><div class="line">		follow_set[A].clear();</div><div class="line">	}</div><div class="line">	</div><div class="line">	follow_set[start_symbol].insert(Grammar::lambda);</div><div class="line">		</div><div class="line">	<span class="keyword">do</span> {</div><div class="line">		changes = <span class="keyword">false</span>;</div><div class="line">		<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; rules.size(); i++) {</div><div class="line">			<span class="comment">/* A -&gt; a B b</span></div><div class="line">			 * I.e. for each production and each occurrence</div><div class="line">			 * of a nonterminal in its right-hand side. </div><div class="line">			 */</div><div class="line">			p = rules[i];</div><div class="line">			A = p.LHS;</div><div class="line">			<span class="keyword">for</span>(size_t j = <span class="number">0</span>; j &lt; p.RHS.size(); j++) {</div><div class="line">				B = p.RHS[j];</div><div class="line">				<span class="keyword">if</span>(isNonterminal(B)) {</div><div class="line">					<span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span> beta(p.RHS.begin() + j + <span class="number">1</span>, p.RHS.end());</div><div class="line">					<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span> rfirst = compute_first(beta);</div><div class="line">					size_t oldsize = follow_set[B].size();</div><div class="line">					</div><div class="line">					<span class="keyword">if</span>(rfirst.find(Grammar::lambda) == rfirst.end()) {</div><div class="line">						follow_set[B].insert(rfirst.begin(), rfirst.end());	</div><div class="line">					} <span class="keyword">else</span> {</div><div class="line">						rfirst.erase(Grammar::lambda);</div><div class="line">						follow_set[B].insert(rfirst.begin(), rfirst.end());	</div><div class="line">						rfirst = follow_set[A];</div><div class="line">						follow_set[B].insert(rfirst.begin(), rfirst.end());</div><div class="line">					}</div><div class="line">					size_t newsize = follow_set[B].size();			</div><div class="line">					<span class="keyword">if</span>(oldsize != newsize)</div><div class="line">						changes = <span class="keyword">true</span>;</div><div class="line">				}</div><div class="line">			}</div><div class="line">		}</div><div class="line">	} <span class="keyword">while</span>(changes);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">void</span> Grammar::lldriver(<span class="stl_container"><span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt;</span> tokens) {</div><div class="line">	<span class="stl_container"><span class="built_in">stack</span>&lt;<span class="built_in">string</span>&gt;</span> 	stk;</div><div class="line">	<span class="built_in">string</span> 			X;</div><div class="line">	<span class="built_in">string</span>			a;</div><div class="line">	Production		p;</div><div class="line">	<span class="comment">/* Push the Start Symbol onto an empty stack */</span></div><div class="line">	stk.push(start_symbol);</div><div class="line">	</div><div class="line">	<span class="keyword">while</span>(!stk.empty() && !tokens.empty()) {</div><div class="line">		X = stk.top();</div><div class="line">		a = tokens.front();</div><div class="line">		<span class="comment">// cout &lt;&lt; X &lt;&lt; " " &lt;&lt; a &lt;&lt; endl;</span></div><div class="line">		<span class="keyword">if</span>(isNonterminal(X) && lltable[X].find(a) != lltable[X].end()) {</div><div class="line">			p = lltable[X][a];</div><div class="line">			stk.pop();</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = p.RHS.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) {</div><div class="line">				<span class="keyword">if</span>(p.RHS[i] == Grammar::lambda)</div><div class="line">					<span class="keyword">continue</span>;</div><div class="line">				stk.push(p.RHS[i]);</div><div class="line">			}</div><div class="line">		} <span class="keyword">else</span> <span class="keyword">if</span>(X == a) {</div><div class="line">			stk.pop();</div><div class="line">			tokens.pop();</div><div class="line">		} <span class="keyword">else</span> <span class="keyword">if</span>(lltable[X].find(Grammar::lambda) != lltable[X].end()) {</div><div class="line">			stk.pop();</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			<span class="comment">/* Process syntax error. */</span></div><div class="line">			<span class="built_in">puts</span>(<span class="string">"Bad!"</span>);</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">while</span>(!stk.empty()) {</div><div class="line">		X = stk.top();</div><div class="line">		<span class="keyword">if</span>(lltable[X].find(Grammar::lambda) != lltable[X].end())</div><div class="line">			stk.pop();</div><div class="line">		<span class="keyword">else</span></div><div class="line">			<span class="keyword">break</span>;</div><div class="line">	}</div><div class="line">	<span class="keyword">if</span>(tokens.size() == <span class="number">0</span> && stk.size() == <span class="number">0</span>)</div><div class="line">		<span class="built_in">puts</span>(<span class="string">"Good"</span>);</div><div class="line">	<span class="keyword">else</span></div><div class="line">		<span class="built_in">puts</span>(<span class="string">"Bad!"</span>);</div><div class="line">	<span class="keyword">return</span>;</div><div class="line">}</div><div class="line"><span class="comment">/* ------------------------</span></div><div class="line">Grammar LR method</div><div class="line">-------------------------- */</div><div class="line"><span class="keyword">void</span> Grammar::build_action() {</div><div class="line">	ConfigurationSet 	s;</div><div class="line">	Production 			P;</div><div class="line">	<span class="keyword">int</span>					dotPos;</div><div class="line">	<span class="stl_container"><span class="built_in">set</span>&lt; pair&lt;Production, ConfigurationSet::State&gt;</span> &gt;::iterator it;</div><div class="line">	</div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; LRstates.size(); i++) {</div><div class="line">		s = LRstates[i];</div><div class="line">		<span class="keyword">int</span> reduce = <span class="number">0</span>, rule = <span class="number">0</span>, accept = <span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(it = s.configs.begin(); it != s.configs.end(); it++) {</div><div class="line">			P = it-&gt;first, dotPos = it-&gt;second.dot;</div><div class="line">			<span class="keyword">if</span>(dotPos == P.RHS.size())</div><div class="line">				reduce++, rule = P.label;</div><div class="line">			accept &= P.LHS == Grammar::start_symbol;</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span>(accept == <span class="number">1</span>)</div><div class="line">			action_table[i] = <span class="number">0</span>;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(reduce == <span class="number">1</span>)</div><div class="line">			action_table[i] = -<span class="number">1</span>;</div><div class="line">		<span class="keyword">else</span></div><div class="line">			action_table[i] = <span class="number">1</span>;</div><div class="line">	}</div><div class="line"><span class="preprocessor">#ifdef DEBUG</span></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"State |"</span>);</div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; LRstates.size(); i++)</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%5d|"</span>, i);</div><div class="line">	<span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"Action|"</span>);</div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; action_table.size(); i++) {</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%5d|"</span>, action_table[i]);</div><div class="line">	}</div><div class="line">	<span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line">}</div><div class="line"><span class="keyword">void</span> Grammar::build_CFSM() {</div><div class="line">	<span class="stl_container"><span class="built_in">set</span>&lt;ConfigurationSet&gt;</span> 	S;</div><div class="line">	<span class="stl_container"><span class="built_in">queue</span>&lt;ConfigurationSet&gt;</span>	Q;</div><div class="line">	ConfigurationSet 		s0, sb;</div><div class="line">	<span class="keyword">int</span> 					label = <span class="number">0</span>;</div><div class="line">	ConfigurationSet::State state;</div><div class="line">	</div><div class="line">	state.dot = <span class="number">0</span>;</div><div class="line">	state.lookahead = <span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span>();</div><div class="line">	state.lookahead.push_back(Grammar::lambda);</div><div class="line">	<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; rules.size(); i++) {</div><div class="line">		<span class="keyword">if</span>(rules[i].LHS == <span class="keyword">this</span>-&gt;start_symbol) {</div><div class="line">			s0.configs.insert(make_pair(rules[i], state));</div><div class="line">		}</div><div class="line">	}</div><div class="line">	s0 = ConfigurationSet::closure0(s0, *<span class="keyword">this</span>);</div><div class="line">	s0.label = label++;</div><div class="line">	</div><div class="line">	S.insert(s0);</div><div class="line">	Q.push(s0);</div><div class="line">	</div><div class="line">	buildSymbols();</div><div class="line">	<span class="comment">/* hw need */</span></div><div class="line">	<span class="stl_container"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="stl_container"><span class="built_in">vector</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="built_in">string</span>&gt;</span> &gt;</span> &gt; hwPrint;</div><div class="line">	<span class="comment">/* hw need */</span></div><div class="line">	<span class="keyword">while</span>(!Q.empty()) {</div><div class="line">		s0 = Q.front(), Q.pop();</div><div class="line">		LRstates.push_back(s0);</div><div class="line">		<span class="keyword">for</span>(<span class="stl_container"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;</span>::iterator it = symbols.begin();</div><div class="line">			it != symbols.end(); it++) {</div><div class="line">			sb = ConfigurationSet::go_to0(s0, *it, *<span class="keyword">this</span>);</div><div class="line">			<span class="keyword">if</span>(sb.configs.size() &gt; <span class="number">0</span>) {</div><div class="line">				<span class="keyword">if</span>(S.find(sb) == S.end()) {</div><div class="line">					sb.label = label++;</div><div class="line">					S.insert(sb);</div><div class="line">					Q.push(sb);</div><div class="line">				}</div><div class="line">				</div><div class="line">				go_to_table[s0.label][*it] = (* S.find(sb)).label;</div><div class="line">				<span class="comment">/* hw need */</span></div><div class="line">				hwPrint[(* S.find(sb)).label].push_back(make_pair(s0.label, *it));</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="comment">// build_action();</span></div><div class="line"><span class="preprocessor">#ifdef DEBUG	</span></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"Total State: %d\n"</span>, label);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; label; i++) {</div><div class="line">		<span class="keyword">if</span>(hwPrint[i].size() &gt; <span class="number">0</span>) {</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"State %d from"</span>, i);</div><div class="line">			<span class="keyword">for</span>(<span class="stl_container"><span class="built_in">vector</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="built_in">string</span>&gt;</span> &gt;::iterator it = hwPrint[i].begin();</div><div class="line">				it != hwPrint[i].end(); it++) {</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%cState %d(%s)"</span>, it == hwPrint[i].begin() ? <span class="string">' '</span> : <span class="string">','</span>, it-&gt;first, it-&gt;second.c_str());</div><div class="line">			}</div><div class="line">			<span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"State %d\n"</span>, i);</div><div class="line">		}</div><div class="line">		LRstates[i].print(*<span class="keyword">this</span>);</div><div class="line">		<span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">	}</div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line">}</div><div class="line"><span class="keyword">int</span> Grammar::slr1driver(<span class="stl_container"><span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt;</span> tokens) {</div><div class="line">	<span class="stl_container"><span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;</span> 		stateStk;</div><div class="line">	<span class="stl_container"><span class="built_in">stack</span>&lt;<span class="built_in">string</span>&gt;</span> 	tokenStk;</div><div class="line">	<span class="keyword">int</span> 			state;</div><div class="line">	<span class="built_in">string</span>			X;</div><div class="line">	</div><div class="line">	stateStk.push(<span class="number">0</span>); <span class="comment">/* push start state */</span></div><div class="line">	<span class="keyword">while</span>(!tokens.empty()) {</div><div class="line">		state = stateStk.top();</div><div class="line">		X = tokens.front();</div><div class="line"><span class="preprocessor">#ifdef DEBUG </span></div><div class="line">		<span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"state %d front %s\n"</span>, state, X.c_str());</div><div class="line">		LRstates[state].print(*<span class="keyword">this</span>);</div><div class="line">		<span class="keyword">for</span> (std::<span class="stl_container"><span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;</span> dump = stateStk; !dump.empty(); dump.pop())</div><div class="line">        	std::<span class="built_in">cout</span> &lt;&lt; <span class="string">"state stack "</span>&lt;&lt; dump.top() &lt;&lt; <span class="string">'\n'</span>;</div><div class="line">		<span class="keyword">for</span> (std::<span class="stl_container"><span class="built_in">stack</span>&lt;<span class="built_in">string</span>&gt;</span> dump = tokenStk; !dump.empty(); dump.pop())</div><div class="line">        	std::<span class="built_in">cout</span> &lt;&lt; <span class="string">"token stack "</span>&lt;&lt; dump.top() &lt;&lt; <span class="string">'\n'</span>;</div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line">		<span class="keyword">int</span> reduce = <span class="number">0</span>, shift = <span class="number">0</span>;</div><div class="line">		Production P;</div><div class="line">		<span class="keyword">for</span>(<span class="stl_container"><span class="built_in">set</span>&lt; pair&lt;Production, ConfigurationSet::State&gt;</span> &gt;::iterator it = LRstates[state].configs.begin(); </div><div class="line">			it != LRstates[state].configs.end(); it++) {</div><div class="line">			Production q = it-&gt;first;</div><div class="line">			ConfigurationSet::State s = it-&gt;second;</div><div class="line">			<span class="keyword">if</span>(follow_set[q.LHS].find(X) != follow_set[q.LHS].end() && </div><div class="line">					(s.dot == q.RHS.size() || q.RHS[<span class="number">0</span>] == Grammar::lambda)) {</div><div class="line">				reduce++;</div><div class="line">				P = q;</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span>(go_to_table[state].find(X) != go_to_table[state].end())</div><div class="line">			shift++;</div><div class="line">		<span class="keyword">if</span>(reduce + shift &gt;= <span class="number">2</span>)</div><div class="line">			assert(<span class="keyword">false</span>); <span class="comment">// grammar can't use simple LR.</span></div><div class="line">		<span class="keyword">if</span>(reduce + shift == <span class="number">0</span>)</div><div class="line">			<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span>(reduce == <span class="number">1</span>) { <span class="comment">// Reduce</span></div><div class="line">			<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; P.RHS.size(); i++) </div><div class="line">				tokenStk.pop(), stateStk.pop();</div><div class="line"></div><div class="line">			tokenStk.push(P.LHS);</div><div class="line">			state = stateStk.top();</div><div class="line">			<span class="keyword">if</span>(go_to_table[state].find(P.LHS) == go_to_table[state].end()) {</div><div class="line">				<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">			}</div><div class="line">			state = go_to_table[state][P.LHS];</div><div class="line">			stateStk.push(state);</div><div class="line">		} <span class="keyword">else</span> { <span class="comment">// shift</span></div><div class="line">			state = go_to_table[state][X];</div><div class="line">			stateStk.push(state);</div><div class="line">			tokenStk.push(X);</div><div class="line">			tokens.pop();</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">while</span>(!stateStk.empty()) {</div><div class="line">		state = stateStk.top();</div><div class="line">		X = Grammar::lambda;</div><div class="line"><span class="preprocessor">#ifdef DEBUG </span></div><div class="line">		<span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"state %d front %s\n"</span>, state, X.c_str());</div><div class="line">		LRstates[state].print(*<span class="keyword">this</span>);</div><div class="line">		<span class="keyword">for</span> (std::<span class="stl_container"><span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;</span> dump = stateStk; !dump.empty(); dump.pop())</div><div class="line">        	std::<span class="built_in">cout</span> &lt;&lt; <span class="string">"state stack "</span>&lt;&lt; dump.top() &lt;&lt; <span class="string">'\n'</span>;</div><div class="line">		<span class="keyword">for</span> (std::<span class="stl_container"><span class="built_in">stack</span>&lt;<span class="built_in">string</span>&gt;</span> dump = tokenStk; !dump.empty(); dump.pop())</div><div class="line">        	std::<span class="built_in">cout</span> &lt;&lt; <span class="string">"token stack "</span>&lt;&lt; dump.top() &lt;&lt; <span class="string">'\n'</span>;</div><div class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></div><div class="line">		<span class="keyword">int</span> reduce = <span class="number">0</span>, shift = <span class="number">0</span>;</div><div class="line">		Production P;</div><div class="line">		<span class="keyword">for</span>(<span class="stl_container"><span class="built_in">set</span>&lt; pair&lt;Production, ConfigurationSet::State&gt;</span> &gt;::iterator it = LRstates[state].configs.begin(); </div><div class="line">			it != LRstates[state].configs.end(); it++) {</div><div class="line">			Production q = it-&gt;first;</div><div class="line">			ConfigurationSet::State s = it-&gt;second;</div><div class="line">			<span class="keyword">if</span>(follow_set[q.LHS].find(X) != follow_set[q.LHS].end() && </div><div class="line">					(s.dot == q.RHS.size() || q.RHS[<span class="number">0</span>] == Grammar::lambda)) {</div><div class="line">				reduce++;</div><div class="line">				P = q;</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span>(go_to_table[state].find(X) != go_to_table[state].end())</div><div class="line">			shift++;</div><div class="line">		<span class="keyword">if</span>(reduce + shift &gt;= <span class="number">2</span>)</div><div class="line">			assert(<span class="keyword">false</span>); <span class="comment">// grammar can't use simple LR.</span></div><div class="line">		<span class="keyword">if</span>(reduce + shift == <span class="number">0</span>)</div><div class="line">			<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span>(reduce == <span class="number">1</span>) { <span class="comment">// Reduce</span></div><div class="line">			<span class="keyword">for</span>(size_t i = <span class="number">0</span>; i &lt; P.RHS.size(); i++) </div><div class="line">				tokenStk.pop(), stateStk.pop();</div><div class="line"></div><div class="line">			tokenStk.push(P.LHS);</div><div class="line">			state = stateStk.top();</div><div class="line">			<span class="keyword">if</span>(go_to_table[state].find(P.LHS) == go_to_table[state].end()) {</div><div class="line">				<span class="keyword">if</span>(P.LHS == Grammar::start_symbol)</div><div class="line">					<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">				<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">			}</div><div class="line">			state = go_to_table[state][P.LHS];</div><div class="line">			stateStk.push(state);</div><div class="line">		} <span class="keyword">else</span> { <span class="comment">// shift</span></div><div class="line">			state = go_to_table[state][X];</div><div class="line">			stateStk.push(state);</div><div class="line">			tokenStk.push(X);</div><div class="line">			tokens.pop();</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="keyword">void</span> parsingProduction(<span class="built_in">string</span> r, Grammar &g) {</div><div class="line">	<span class="keyword">static</span> <span class="keyword">int</span> 		production_label = <span class="number">0</span>;</div><div class="line">	<span class="built_in">stringstream</span> 	<span class="built_in">sin</span>(r);</div><div class="line">	<span class="built_in">string</span> 			lhs, foo;</div><div class="line">	<span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span> 	tokens;</div><div class="line">	<span class="built_in">sin</span> &gt;&gt; lhs &gt;&gt; foo;</div><div class="line">	<span class="keyword">while</span>(<span class="built_in">sin</span> &gt;&gt; foo)</div><div class="line">		tokens.push_back(foo);</div><div class="line">	Production p(lhs, tokens);</div><div class="line">	p.label = ++production_label;</div><div class="line">	g.rules.push_back(p);</div><div class="line">}</div><div class="line"><span class="keyword">bool</span> isNumber(<span class="built_in">string</span> str) {</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++) {</div><div class="line">		<span class="keyword">if</span>(!<span class="built_in">isdigit</span>(str[i]))</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> scanTokens(<span class="keyword">char</span> s[], <span class="stl_container"><span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt;</span>& tokens, <span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span>& val) {</div><div class="line">	<span class="built_in">string</span> keyword[<span class="number">18</span>] = {<span class="string">"AND"</span>, <span class="string">"THEN"</span>, <span class="string">"GO"</span>, <span class="string">"KEEP"</span>, </div><div class="line">			<span class="string">"RIGHT"</span>, <span class="string">"LEFT"</span>, <span class="string">"FIRST"</span>, <span class="string">"SECOND"</span>, <span class="string">"THIRD"</span>, </div><div class="line">			<span class="string">"AT"</span>, <span class="string">"RECORD"</span>, <span class="string">"TIME"</span>, <span class="string">"TO"</span>, <span class="string">"KMH"</span>, <span class="string">"CHANGE"</span>,</div><div class="line">			<span class="string">"AVERAGE"</span>, <span class="string">"SPEED"</span>, <span class="string">"CAS"</span>};</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; s[i]; i++) {</div><div class="line">		<span class="keyword">if</span>(s[i] == <span class="string">'"'</span>) {</div><div class="line">			<span class="comment">// s-word can't empty, and after the opening speech marks no more space.</span></div><div class="line">			<span class="keyword">if</span>(s[i + <span class="number">1</span>] == <span class="string">'"'</span> || <span class="built_in">isspace</span>(s[i + <span class="number">1</span>]))	</div><div class="line">				<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">			i++;</div><div class="line">			<span class="keyword">while</span>(s[i] != <span class="string">'"'</span>) {</div><div class="line">				<span class="keyword">if</span>(<span class="built_in">isupper</span>(s[i])) {}</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">isspace</span>(s[i])) {s[i] = <span class="string">'_'</span>;}</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(s[i] == <span class="string">'.'</span>) {</div><div class="line">					<span class="keyword">if</span>(<span class="built_in">isspace</span>(s[i - <span class="number">1</span>]) || s[i - <span class="number">1</span>] == <span class="string">'_'</span>) {</div><div class="line">						<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">					}</div><div class="line">				} <span class="keyword">else</span> {</div><div class="line">					<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">				}</div><div class="line">				i++;</div><div class="line">			}</div><div class="line">			<span class="keyword">if</span>(s[i] == <span class="string">'\0'</span> || <span class="built_in">isspace</span>(s[i - <span class="number">1</span>]) || s[i - <span class="number">1</span>] == <span class="string">'_'</span>)</div><div class="line">				<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="built_in">stringstream</span> 	<span class="built_in">sin</span>(s);</div><div class="line">	<span class="built_in">string</span> 			token;</div><div class="line">	<span class="keyword">while</span>(<span class="built_in">sin</span> &gt;&gt; token) {</div><div class="line">		<span class="keyword">int</span> f = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">18</span>; i++) {</div><div class="line">			<span class="keyword">if</span>(token == keyword[i])</div><div class="line">				tokens.push(token), val.push_back(token), f = <span class="number">1</span>;</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span>(f)	<span class="keyword">continue</span>;</div><div class="line">		<span class="keyword">if</span>(token[<span class="number">0</span>] == <span class="string">'"'</span>)</div><div class="line">			tokens.push(<span class="string">"SIGNWORDS"</span>), val.push_back(token), f = <span class="number">1</span>;</div><div class="line">		<span class="keyword">if</span>(f)	<span class="keyword">continue</span>;</div><div class="line">		<span class="keyword">if</span>(isNumber(token))</div><div class="line">			tokens.push(<span class="string">"NNN"</span>), val.push_back(token), f = <span class="number">1</span>;</div><div class="line">		<span class="keyword">if</span>(f)	<span class="keyword">continue</span>;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> main() {</div><div class="line"><span class="comment">//	freopen("in.txt", "r+t", stdin);</span></div><div class="line"><span class="comment">//	freopen("out.txt", "w+t", stdout);</span></div><div class="line">	Grammar g;</div><div class="line">	parsingProduction(<span class="string">"&lt;instruction&gt; 	-&gt; &lt;navigational&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;instruction&gt; 	-&gt; &lt;time-keeping&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;instruction&gt; 	-&gt; &lt;navigational&gt; AND &lt;time-keeping&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;navigational&gt; 	-&gt; &lt;directional&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;navigational&gt; 	-&gt; &lt;navigational&gt; AND THEN &lt;directional&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;directional&gt; 	-&gt; &lt;how&gt; &lt;direction&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;directional&gt; 	-&gt; &lt;how&gt; &lt;direction&gt; &lt;where&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;how&gt; 			-&gt; GO"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;how&gt; 			-&gt; GO &lt;when&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;how&gt;			-&gt; KEEP"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;direction&gt; 		-&gt; RIGHT"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;direction&gt;		-&gt; LEFT"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;when&gt;			-&gt; FIRST"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;when&gt;			-&gt; SECOND"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;when&gt;			-&gt; THIRD"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;where&gt; 			-&gt; AT &lt;sign&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;sign&gt;			-&gt; SIGNWORDS"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;time-keeping&gt; 	-&gt; &lt;record&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;time-keeping&gt;	-&gt; &lt;change&gt;"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;record&gt;			-&gt; RECORD TIME"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;change&gt;			-&gt; &lt;cas&gt; TO NNN KMH"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;cas&gt;			-&gt; CHANGE AVERAGE SPEED"</span>, g);</div><div class="line">	parsingProduction(<span class="string">"&lt;cas&gt; 			-&gt; CAS"</span>, g);</div><div class="line">	g.start_symbol = <span class="string">"&lt;instruction&gt;"</span>;</div><div class="line">		</div><div class="line">	g.fill_first_set();</div><div class="line">	g.fill_follow_set();</div><div class="line">	g.build_CFSM();</div><div class="line">	</div><div class="line">	<span class="keyword">char</span> 	line[<span class="number">1024</span>];</div><div class="line">	<span class="keyword">int</span> 	cases = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span>(gets(line)) {</div><div class="line">		<span class="keyword">if</span>(!<span class="built_in">strcmp</span>(line, <span class="string">"#"</span>))</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="stl_container"><span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt;</span> tokens;</div><div class="line">		<span class="stl_container"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;</span> val;</div><div class="line">		<span class="keyword">int</span> f = scanTokens(line, tokens, val);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%3d."</span>, ++cases);</div><div class="line">		<span class="keyword">if</span>(!f) {</div><div class="line">			<span class="built_in">puts</span>(<span class="string">" Trap!"</span>);</div><div class="line">			<span class="keyword">continue</span>;</div><div class="line">		}</div><div class="line">		f = g.slr1driver(tokens);</div><div class="line">		<span class="keyword">if</span>(!f) {</div><div class="line">			<span class="built_in">puts</span>(<span class="string">" Trap!"</span>);</div><div class="line">			<span class="keyword">continue</span>;</div><div class="line">		}</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; val.size(); i++) {</div><div class="line">			<span class="keyword">if</span>(val[i][<span class="number">0</span>] == <span class="string">'"'</span>)</div><div class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; val[i].length(); j++)</div><div class="line">					<span class="keyword">if</span>(val[i][j] == <span class="string">'_'</span>)</div><div class="line">						val[i][j] = <span class="string">' '</span>;</div><div class="line">			<span class="built_in">printf</span>(<span class="string">" %s"</span>, val[i].c_str());</div><div class="line">		}</div><div class="line">		<span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>


          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-345" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/19/oj/uva/uva-345/" class="article-date">
  <time datetime="2014-06-18T23:08:16.000Z" itemprop="datePublished">Jun 19 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/19/oj/uva/uva-345/">UVa 345 - It&#39;s Ir-Resist-Able</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/19/oj/uva/uva-345/" data-id="tlgx6n0picjrtjha" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/19/oj/uva/uva-345/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/高斯消去/">高斯消去</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem">Problem</h2>
<p>A common component in electronic circuits is the resistor. Each resistor has two terminals, and when current flows through a resistor, some of it is converted to heat, thus ``resisting”; the flow of the current. The extent to which it does this is indicated by a single positive numeric value, cleverly called the resistance of the resistor. By the way, the units of resistance are Ohms. Here’s what a single resistor looks like in a diagram of an electronic circuit:</p>
<p>When two resistors are connected in series, as shown below, then their equivalent resistance is just the sum of the resistances of the individual resistors. For example, if the two resistors below had resistances of 100 and 200 Ohms, respectively, then the combined resistance (from point A to point B) would be 300 Ohms. Of course, combining three or more resistors in series would yield a resistance equal to sum of all the individual resistances.</p>
<p>Resistors may also be connected in parallel, like this:</p>
<p>If these two resistors had resistances of 100 and 150 Ohms, then the parallel combination would yield an equivalent resistance between points A and B of</p>
<p>displaymath61</p>
<p>Connecting three resistors in parallel uses the same rule, so a 100 Ohm, 150 Ohm, and 300 Ohm resistor in parallel would yield a combined resistance of just 50 Ohms: that is,</p>
<p>displaymath63</p>
<p>In this problem you’re provided one or more descriptions of resistors and their interconnections. Each possible interconnection point (the terminals of a resistor) is identified by a unique positive integer, its label. And each resistor is specified by giving its two interconnection point labels and its resistance (as a real number).</p>
<p>For example, the input</p>
<p>1 2 100</p>
<p>would tell us that a 100 Ohm resistor was connected between points 1 and 2. A pair of resistors connected in series might be specified like this:</p>
<p>1 2 100<br>2 3 200</p>
<p>Here we’ve got our 100 Ohm resistor connected at points 1 and 2, and another 200 Ohm resistor connected to points 2 and 3. Two resistors in parallel would be similarly specified:</p>
<p>1 2 100<br>1 2 150</p>
<p>Once you know how the resistors are interconnected, and the resistance of each resistor, it’s possible to determine the equivalent resistance between any two points using the simple rules given above. In some cases, that is. Some interconnections of resistors can’t be solved using this approach: you won’t encounter any of these in this problem, however.</p>
<p>Notes</p>
<ul>
<li>Be aware that there may be input test cases with some resistors that don’t contribute to the overall resistance between the indicated points. For example, in the last case shown in the Sample Input section below, the resistor between points 1 and 2 is unused. There must be some flow through a resistor if it is to contribute to the overall resistance.</li>
<li>No resistor will have its ends connected together. That is, the labels associated with the ends of a resistor will always be distinct. </li>
</ul>
<h2 id="Input">Input</h2>
<p>There will be one or more cases to consider. Each will begin with a line containing three integers N, A, and B. A and B indicate the labels of points between which you are to determine the equivalent resistance. N is the number of individual resistors, and will be no larger than 30. N, A and B will all be zero in the line following the last case. Following each <code>N A B</code> line will be N lines, each specifying the labels of the points where a resistor is connected, and the resistance of that resistor, given as a real number.</p>
<h2 id="Output">Output</h2>
<p>For each input case, display a line that includes the case number (they are numbered sequentially starting with 1) and the equivalent resistance, accurate to two decimal places.</p>
<h2 id="Sample_Input">Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">2 1 3</div><div class="line">1 2 100</div><div class="line">2 3 200</div><div class="line">2 1 2</div><div class="line">1 2 100</div><div class="line">1 2 150</div><div class="line">6 1 6</div><div class="line">1 2 500</div><div class="line">1 3 15</div><div class="line">3 4 40</div><div class="line">3 5 100</div><div class="line">4 6 60</div><div class="line">5 6 50</div><div class="line">0 0 0</div></pre></td></tr></table></figure>

<h2 id="Sample_Output">Sample Output</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Case</span> <span class="number">1</span>: <span class="number">300.00</span> Ohms</div><div class="line"><span class="keyword">Case</span> <span class="number">2</span>: <span class="number">60.00</span> Ohms</div><div class="line"><span class="keyword">Case</span> <span class="number">3</span>: <span class="number">75.00</span> Ohms</div></pre></td></tr></table></figure>

<h2 id="Solution">Solution</h2>
<p><strong> 題目描述： </strong></p>
<p>給定指定的兩個端點 A B，接著會有 N 個電阻，每個電阻值位於端點 X Y 之間。<br>求 A B 之間的等效電阻，特別注意到端點編號是任意整數，並且有可能兩個端點相同 (A = B)，也有可能會有無會流經的電路區域。</p>
<p><strong> 題目解法： </strong></p>
<p>我們假設每個端點的電動勢 (Volt)，使用克希荷夫電路定律（Kirchhoff Circuit Laws）中的 <strong> 電流定律 </strong>，得到下列公式。</p>
<p>對於每一個端點而言，入電流總量等於出電流總量：</p>
<span>$$\sum_{j = 1}^{n} \frac{V_{j} - V_{i}}{R_{i, j}} = 0$$</span>

<p>但是題目給定的起點和終點並不會在其中，因此假設起點 <code>V[A] = INF</code>，終點 <code>V[B] = 0</code>，接著算出其他所有點的電動勢。共有 <code>n - 2</code> 條方程式，<code>n - 2</code> 個變數，使用高斯消去求解。</p>
<ul>
<li>必須預處理與起點、終點之間的電流關係。</li>
<li>特別注意到起點和終點相同，直接輸出等效電阻 0。</li>
<li>端點編號離散化集中處理。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt; </span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;algorithm&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;math.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;map&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;iostream&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="comment">// learn: http://blog.csdn.net/jiangshibiao/article/details/28661223		</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> MAXN 105</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> INF 1e+6</span></div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> eps 1e-9</span></div><div class="line"><span class="keyword">double</span> R[MAXN][MAXN] = {}, V[MAXN] = {}; <span class="comment">// R: resist, V: voltage</span></div><div class="line"><span class="keyword">double</span> f[MAXN][MAXN] = {}; <span class="comment">// function need solved;</span></div><div class="line"><span class="keyword">int</span> main() {</div><div class="line">	<span class="keyword">int</span> N, A, B;</div><div class="line">	<span class="keyword">int</span> x, y, l;</div><div class="line">	<span class="keyword">int</span> cases = <span class="number">0</span>;</div><div class="line">	<span class="keyword">double</span> w;</div><div class="line">	<span class="keyword">char</span> s1[<span class="number">105</span>], s2[<span class="number">105</span>];</div><div class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;A, &amp;B) == <span class="number">3</span>) {</div><div class="line">		<span class="keyword">if</span>(N == <span class="number">0</span>)</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="stl_container"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;</span> label;</div><div class="line">		l = label[A];</div><div class="line">		<span class="keyword">if</span>(l == <span class="number">0</span>)	label[A] = label.size();</div><div class="line">		A = label[A];</div><div class="line">		</div><div class="line">		l = label[B];</div><div class="line">		<span class="keyword">if</span>(l == <span class="number">0</span>)	label[B] = label.size();</div><div class="line">		B = label[B];</div><div class="line">		</div><div class="line">		<span class="built_in">memset</span>(R, <span class="number">0</span>, <span class="keyword">sizeof</span>(R));</div><div class="line">		<span class="built_in">memset</span>(V, <span class="number">0</span>, <span class="keyword">sizeof</span>(V));</div><div class="line">		<span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="keyword">sizeof</span>(f));</div><div class="line">		<span class="stl_container"><span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt;</span> g[MAXN][MAXN];</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) {</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d %d %lf"</span>, &amp;x, &amp;y, &amp;w);</div><div class="line">			</div><div class="line">			l = label[x];</div><div class="line">			<span class="keyword">if</span>(l == <span class="number">0</span>)	label[x] = label.size();</div><div class="line">			x = label[x];</div><div class="line">			</div><div class="line">			l = label[y];</div><div class="line">			<span class="keyword">if</span>(l == <span class="number">0</span>)	label[y] = label.size();</div><div class="line">			y = label[y];</div><div class="line">			</div><div class="line">			g[x][y].push_back(w);</div><div class="line">			g[y][x].push_back(w);</div><div class="line">		}</div><div class="line">		N = label.size();</div><div class="line"></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) {</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++) {</div><div class="line">				<span class="keyword">if</span>(g[i][j].size()) {</div><div class="line">					<span class="keyword">double</span> r = <span class="number">0</span>;</div><div class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; g[i][j].size(); k++) {</div><div class="line">						r += <span class="number">1.0</span> / g[i][j][k];</div><div class="line">					}</div><div class="line">					R[i][j] = <span class="number">1.0</span> / r;</div><div class="line">				}</div><div class="line">			}</div><div class="line">		}</div><div class="line">		V[A] = INF, V[B] = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) {</div><div class="line">			<span class="keyword">if</span>(i == A)	<span class="keyword">continue</span>;</div><div class="line">			<span class="keyword">if</span>(i == B)	<span class="keyword">continue</span>;</div><div class="line">			<span class="keyword">if</span>(R[i][A] &gt; <span class="number">0</span>)</div><div class="line">				f[i][i] -= <span class="number">1.0</span> / R[i][A], f[i][N + <span class="number">1</span>] -= V[A] / R[i][A];</div><div class="line">			<span class="keyword">if</span>(R[i][B] &gt; <span class="number">0</span>)</div><div class="line">				f[i][i] -= <span class="number">1.0</span> / R[i][B], f[i][N + <span class="number">1</span>] -= V[B] / R[i][B];</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++) {</div><div class="line">				<span class="keyword">if</span>(R[i][j] &gt; <span class="number">0</span> &amp;&amp; i != j &amp;&amp; j != A &amp;&amp; j != B)</div><div class="line">					f[i][j] = <span class="number">1.0</span> / R[i][j], f[i][i] -= <span class="number">1.0</span> / R[i][j];</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="comment">// Gaussian Elimination</span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) {</div><div class="line">			<span class="keyword">int</span> k = i;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt;= N; j++)</div><div class="line">				<span class="keyword">if</span>(f[j][i] &gt; <span class="number">0</span>)</div><div class="line">					k = j;</div><div class="line">			<span class="keyword">if</span>(<span class="built_in">fabs</span>(f[k][i]) &lt; eps)</div><div class="line">				<span class="keyword">continue</span>;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N + <span class="number">1</span>; j++)</div><div class="line">				swap(f[i][j], f[k][j]);</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++) {</div><div class="line">				<span class="keyword">if</span>(i == j)	<span class="keyword">continue</span>;</div><div class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> k = N + <span class="number">1</span>; k &gt;= i; k--)</div><div class="line">					f[j][k] = f[j][k] - f[j][i] / f[i][i] * f[i][k];</div><div class="line">			}</div><div class="line">		}</div><div class="line"></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) {</div><div class="line">			<span class="keyword">if</span>(i == A)	<span class="keyword">continue</span>;</div><div class="line">			<span class="keyword">if</span>(i == B)	<span class="keyword">continue</span>;</div><div class="line">			<span class="keyword">if</span>(<span class="built_in">fabs</span>(f[i][i]) &gt; eps)</div><div class="line">				V[i] = f[i][N + <span class="number">1</span>] / f[i][i];</div><div class="line">		}</div><div class="line">		</div><div class="line">		<span class="keyword">double</span> IB = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</div><div class="line">			<span class="keyword">if</span>(R[i][B] &gt; <span class="number">0</span>)</div><div class="line">				IB += V[i] / R[i][B];</div><div class="line">		<span class="keyword">if</span>(<span class="built_in">fabs</span>(IB) &lt; eps)</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"Case %d: %.2lf Ohms\n"</span>, ++cases, <span class="number">0</span>);</div><div class="line">		<span class="keyword">else</span></div><div class="line">			<span class="built_in">printf</span>(<span class="string">"Case %d: %.2lf Ohms\n"</span>, ++cases, (V[A] - V[B]) / IB);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-313" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/17/oj/uva/uva-313/" class="article-date">
  <time datetime="2014-06-16T23:19:14.000Z" itemprop="datePublished">Jun 17 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/17/oj/uva/uva-313/">UVa 313 - Intervals</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/17/oj/uva/uva-313/" data-id="pyzrm1wlkuyem3tj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/17/oj/uva/uva-313/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/幾何/">幾何</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/掃描線/">掃描線</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem">Problem</h2>
<p>In the ceiling in the basement of a newly open developers building a light source has been installed. Unfortunately, the material used to cover the floor is very sensitive to light. It turned out that its expected life time is decreasing dramatically. To avoid this, authorities have decided to protect light sensitive areas from strong light by covering them. The solution was not very easy because, as it is common, in the basement there are different pipelines under the ceiling and the authorities want to install the covers just on those parts of the floor that are not shielded from the light by pipes. To cope with the situation, the first decision was to simplify the real situation and, instead of solving the problem in 3D space, to construct a 2D model first.</p>
<p>Within this model, the x-axis has been aligned with the level of the floor. The light is considered to be a point light source with integer co-ordinates tex2html_wrap_inline36 . The pipes are represented by circles. The center of the circle i has the integer co-ordinates tex2html_wrap_inline40 and an integer radius tex2html_wrap_inline42 . As pipes are made from solid material, circles cannot overlap. Pipes cannot reflect the light and the light cannot go through the pipes. You have to write a program which will determine the non-overlapping intervals on the x-axis where there is, due to the pipes, no light from the light source.</p>
<h2 id="Input">Input</h2>
<p>The input file consists of blocks of lines, each of which except the last describes one situation in the basement. The first line of each block contains a positive integer number N &lt; 500 expressing the number of pipes. The second line of the block contains two integers tex2html_wrap_inline48 and tex2html_wrap_inline50 separated by one space. Each of the next N lines of the block contains integers tex2html_wrap_inline54 , tex2html_wrap_inline56 and tex2html_wrap_inline42 , where tex2html_wrap_inline60 . Integers in individual lines are separated by one space. The last block consists of one line containing n = 0.</p>
<h2 id="Output">Output</h2>
<p>The output file consists of blocks of lines, corresponding to the blocks in the file (except the last one). One empty line must be put after each block in the output file. Each of the individual lines of the blocks in the output file will contain two real numbers, the endpoints of the interval where there is no light from the given point light source. The reals are exact to two decimal places and separated by one space. The intervals are sorted according to increasing x-coordinate.</p>
<h2 id="Sample_Input">Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">6</div><div class="line">300 450</div><div class="line">70 50 30</div><div class="line">120 20 20</div><div class="line">270 40 10</div><div class="line">250 85 20</div><div class="line">220 30 30</div><div class="line">380 100 100</div><div class="line">1</div><div class="line">300 300</div><div class="line">300 150 90</div><div class="line">1</div><div class="line">300 300</div><div class="line">390 150 90</div><div class="line">0</div></pre></td></tr></table></figure>

<h2 id="Sample_Output">Sample Output</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">0.72 78.86</div><div class="line">88.50 133.94</div><div class="line">181.04 549.93</div><div class="line"></div><div class="line">75.00 525.00</div><div class="line"></div><div class="line">300.00 862.50</div></pre></td></tr></table></figure>

<h2 id="Solution">Solution</h2>
<p><strong> 題目描述： </strong></p>
<p>現在天花板上面有一盞燈，然後下方有數個圓，請問陰影部分的區間由小至大輸出分別為何。<br>假設不會有圓的高度大於燈的位置，而陰影呈現在 x 軸上。</p>
<p><strong> 題目解法： </strong></p>
<p>求圓 (cx, cy, r) 外一點的切線，由於點 (a, b) 在圓外，通常此點切於圓的線會有兩條。</p>
<p>假設該線斜率為 m，則通過的線為 <code>y = m * (x - a) + b</code>。</p>
<p>藉由點線距公式 <code>|m * (cx - a) - cy + b |/sqrt(m*m + 1) = r</code>，求得 m 之後得到兩條切線，往後求交 x 軸的位置即可。(特別考慮 m 不存在的情況)</p>
<p>最後使用掃描線算法來算聯集。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;algorithm&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;math.h&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> main() {</div><div class="line">    <span class="keyword">int</span> N;</div><div class="line">    <span class="keyword">double</span> bx, by, cx, cy, cr;</div><div class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &N) == <span class="number">1</span> && N) {</div><div class="line">    	<span class="built_in">scanf</span>(<span class="string">"%lf %lf"</span>, &bx, &by);</div><div class="line">        <span class="stl_container"><span class="built_in">vector</span>&lt; pair&lt;<span class="keyword">double</span>, <span class="keyword">double</span>&gt;</span> &gt; interval;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) {</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf %lf %lf"</span>, &cx, &cy, &cr);</div><div class="line">            <span class="keyword">double</span> a, b, c;</div><div class="line">            a = (cx - bx) * (cx - bx) - cr * cr;</div><div class="line">            b = <span class="number">2</span> * (cx - bx) * (by - cy);</div><div class="line">            c = (by - cy) * (by - cy) - cr * cr;</div><div class="line">            <span class="keyword">if</span> (b * b - <span class="number">4</span> * a * c &gt; <span class="number">0</span>) {</div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> eps 1e-6</span></div><div class="line">                <span class="keyword">if</span> (<span class="built_in">fabs</span>(a) &gt; eps) {</div><div class="line">                    <span class="keyword">double</span> m1 = (-b + <span class="built_in">sqrt</span>(b * b - <span class="number">4</span> * a * c))/(<span class="number">2</span> * a);</div><div class="line">                    <span class="keyword">double</span> m2 = (-b - <span class="built_in">sqrt</span>(b * b - <span class="number">4</span> * a * c))/(<span class="number">2</span> * a);</div><div class="line">                    <span class="keyword">double</span> l, r;</div><div class="line">                    c = by - m1 * bx;</div><div class="line">                    l = -c / m1;</div><div class="line">                    c = by - m2 * bx;</div><div class="line">                    r = -c / m2;</div><div class="line">                    <span class="keyword">if</span> (l &gt;= r)</div><div class="line">                        swap(l, r);</div><div class="line">                    interval.push_back(make_pair(l, r));</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    <span class="keyword">double</span> m1 = -c / b;</div><div class="line">                    <span class="keyword">double</span> l, r;</div><div class="line">                    c = by - m1 * bx;</div><div class="line">                    l = -c / m1;</div><div class="line">                    r = bx;</div><div class="line">                    <span class="keyword">if</span> (l &gt;= r)</div><div class="line">                        swap(l, r);</div><div class="line">                    interval.push_back(make_pair(l, r));</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        sort(interval.begin(), interval.end());</div><div class="line">        <span class="keyword">double</span> coverL, coverR;</div><div class="line">        coverL = interval[<span class="number">0</span>].first;</div><div class="line">        coverR = interval[<span class="number">0</span>].second;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; interval.size(); i++) {</div><div class="line">            <span class="keyword">if</span> (interval[i].first &lt;= coverR) {</div><div class="line">                coverR = max(coverR, interval[i].second);</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"%.2lf %.2lf\n"</span>, coverL, coverR);</div><div class="line">                coverL = interval[i].first;</div><div class="line">                coverR = interval[i].second;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%.2lf %.2lf\n"</span>, coverL, coverR);</div><div class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>


          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-10118" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/16/oj/uva/uva-10118/" class="article-date">
  <time datetime="2014-06-15T23:06:43.000Z" itemprop="datePublished">Jun 16 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/16/oj/uva/uva-10118/">UVa 10118 - Free Candies</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/16/oj/uva/uva-10118/" data-id="m631acnxuvype7v5" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/16/oj/uva/uva-10118/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/搜索/">搜索</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="The_Problem">The Problem</h2>
<p>Little Bob is playing a game. He wants to win some candies in it - as many as possible.</p>
<p>There are 4 piles, each pile contains N candies. Bob is given a basket which can hold at most 5 candies. Each time, he puts a candy at the top of one pile into the basket, and if there’re two candies of the same color in it ,he can take both of them outside the basket and put them into his own pocket. When the basket is full and there are no two candies of the same color, the game ends. If the game is played perfectly, the game will end with no candies left in the piles.</p>
<p>For example, Bob may play this game like this (N=5):</p>
<p>Step1     Initial Piles     Step2     Take one from pile #2<br>Piles     Basket     Pocket     Piles     Basket     Pocket</p>
<p>1 2 3 4<br>1 5 6 7<br>2 3 3 3<br>4 9 8 6<br>8 7 2 1</p>
<pre><code><span class="literal">nothing</span>     <span class="literal">nothing</span>     
</code></pre><p>1   3 4<br>1 5 6 7<br>2 3 3 3<br>4 9 8 6<br>8 7 2 1</p>
<pre><code><span class="number">2</span>     <span class="literal">nothing</span>
</code></pre><p>Step3     Take one from pile #2     Step4     Take one from pile #3<br>Piles     Basket     Pocket     Piles     Basket     Pocket</p>
<p>1   3 4<br>1   6 7<br>2 3 3 3<br>4 9 8 6<br>8 7 2 1</p>
<pre><code><span class="number">2</span> <span class="number">5</span>     <span class="literal">nothing</span>     
</code></pre><p>1     4<br>1   6 7<br>2 3 3 3<br>4 9 8 6<br>8 7 2 1</p>
<pre><code><span class="number">2</span> <span class="number">3</span> <span class="number">5</span>     <span class="literal">nothing</span>
</code></pre><p>Step5     Take one from pile #2     Step6     put two candies into his pocket<br>Piles     Basket     Pocket     Piles     Basket     Pocket</p>
<p>1     4<br>1   6 7<br>2   3 3<br>4 9 8 6<br>8 7 2 1</p>
<pre><code><span class="number">2</span> <span class="number">3</span> <span class="number">3</span> <span class="number">5</span>     <span class="literal">nothing</span>     
</code></pre><p>1     4<br>1   6 7<br>2   3 3<br>4 9 8 6<br>8 7 2 1</p>
<pre><code><span class="number">2</span> <span class="number">5</span>     <span class="operator">a</span> pair <span class="operator">of</span> <span class="number">3</span>
</code></pre><p>Note that different numbers indicate different colors, there are 20 kinds of colors numbered 1..20.</p>
<p>‘Seems so hard…’Bob got very much puzzled. How many pairs of candies could he take home at most?</p>
<h2 id="The_Input">The Input</h2>
<p>The input will contain no more than 10 test cases. Each test case begins with a line containing a single integer n(1&lt;=n&lt;=40) representing the height of the piles. In the following n lines, each line contains four integers xi1,xi2,xi3,xi4 (in the range 1..20). Each integer indicates the color of the corresponding candy. The test case containing n=0 will terminate the input, you should not give an answer to this case.</p>
<h2 id="The_Output">The Output</h2>
<p>Output the number of pairs of candies that the cleverest little child can take home. Print your answer in a single line for each test case.</p>
<h2 id="Sample_Input">Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">5</div><div class="line">1 2 3 4</div><div class="line">1 5 6 7</div><div class="line">2 3 3 3</div><div class="line">4 9 8 6</div><div class="line">8 7 2 1</div><div class="line">1</div><div class="line">1 2 3 4</div><div class="line">3</div><div class="line">1 2 3 4</div><div class="line">5 6 7 8</div><div class="line">1 2 3 4</div><div class="line">0</div></pre></td></tr></table></figure>

<h2 id="Sample_Output">Sample Output</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">8</div><div class="line">0</div><div class="line">3</div></pre></td></tr></table></figure>

<h2 id="Solution">Solution</h2>
<p><strong> 題目描述： </strong></p>
<p>現在盤面上共有 4 堆，每一堆呈現 stack 的方式，並且每一堆都會有 n 個糖果，接下來每一步將會把每一堆的 top 糖果放入籃子中，假使籃子中有相同編號的糖果，則會將這兩個相同編號的糖果收入口袋。請問到籃子滿 5 個糖果之前，最多有多少對的糖果可以帶回家。</p>
<p><strong> 題目解法： </strong></p>
<p>將搜索狀態進行標記，之後走訪遇到相同狀態直接退回。這個問題在相同狀態下的結果必然相同。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt; </span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;algorithm&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;iostream&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> MAXN 45</span></div><div class="line"><span class="keyword">int</span> N, pile[<span class="number">4</span>][MAXN];</div><div class="line"><span class="keyword">int</span> used[MAXN][MAXN][MAXN][MAXN] = {}, testcase = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> dp[MAXN][MAXN][MAXN][MAXN];</div><div class="line"><span class="keyword">int</span> dfs(<span class="keyword">int</span> p1, <span class="keyword">int</span> p2, <span class="keyword">int</span> p3, <span class="keyword">int</span> p4, <span class="keyword">int</span> state) {</div><div class="line">	<span class="keyword">if</span>(__builtin_popcount(state) == <span class="number">5</span>)</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span>(used[p1][p2][p3][p4] == testcase)</div><div class="line">		<span class="keyword">return</span> dp[p1][p2][p3][p4];</div><div class="line">	used[p1][p2][p3][p4] = testcase;</div><div class="line">	<span class="keyword">int</span> &amp;ret = dp[p1][p2][p3][p4];</div><div class="line">	<span class="keyword">int</span> t, v;</div><div class="line">	ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span>(p1 &lt; N) {</div><div class="line">		t = pile[<span class="number">0</span>][p1];</div><div class="line">		v = (state&gt;&gt;t)&amp;<span class="number">1</span>;</div><div class="line">		ret = max(ret, v + dfs(p1+<span class="number">1</span>, p2, p3, p4, state^(<span class="number">1</span>&lt;&lt;t)));</div><div class="line">	}</div><div class="line">	<span class="keyword">if</span>(p2 &lt; N) {</div><div class="line">		t = pile[<span class="number">1</span>][p2];</div><div class="line">		v = (state&gt;&gt;t)&amp;<span class="number">1</span>;</div><div class="line">		ret = max(ret, v + dfs(p1, p2+<span class="number">1</span>, p3, p4, state^(<span class="number">1</span>&lt;&lt;t)));</div><div class="line">	}</div><div class="line">	<span class="keyword">if</span>(p3 &lt; N) {</div><div class="line">		t = pile[<span class="number">2</span>][p3];</div><div class="line">		v = (state&gt;&gt;t)&amp;<span class="number">1</span>;</div><div class="line">		ret = max(ret, v + dfs(p1, p2, p3+<span class="number">1</span>, p4, state^(<span class="number">1</span>&lt;&lt;t)));</div><div class="line">	}</div><div class="line">	<span class="keyword">if</span>(p4 &lt; N) {</div><div class="line">		t = pile[<span class="number">3</span>][p4];</div><div class="line">		v = (state&gt;&gt;t)&amp;<span class="number">1</span>;</div><div class="line">		ret = max(ret, v + dfs(p1, p2, p3, p4+<span class="number">1</span>, state^(<span class="number">1</span>&lt;&lt;t)));</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> main() {</div><div class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;N) == <span class="number">1</span> &amp;&amp; N) {</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</div><div class="line">				<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;pile[j][i]);</div><div class="line">		testcase++;</div><div class="line">		<span class="keyword">int</span> ret = dfs(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-12598" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/14/oj/uva/uva-12598/" class="article-date">
  <time datetime="2014-06-14T01:00:08.000Z" itemprop="datePublished">Jun 14 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/14/oj/uva/uva-12598/">UVa 12598 - Starting School</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/14/oj/uva/uva-12598/" data-id="utpkmcgggg518n37" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/14/oj/uva/uva-12598/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/二分/">二分</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem">Problem</h2>
<p>The first day of school is a very memorable day to everyone. Po is starting school from today and Po is very excited. As this is Po’s first day at school, no one is assigned roll number yet. So all the students form a line in the school field and they are being assigned roll number one by one. The teacher is a bit crazy. Instead of assigning roll number from 1, she starts assigning them one by one in a random fashion. Po watches this madness for the first K students and then steps up. Po says Po can assign them very easily for the rest of the students. The idea is very simple. Roll number should be unique and a student should get the smallest roll number that has not been assigned yet to any of the students. For example if K = 4, total number of students are 10 and the first K students’ roll numbers are 1, 3, 5, 10 then the next 6 roll numbers should be 2, 4, 6, 7, 8 and 9.</p>
<blockquote>
<p>開學第一天是值得紀念的，Po 從今天開始在這所學校上課，他相當地興奮。Po 到達學校的第一天，沒有人被指派座號，因此所有的學生都在操場上等著被一個接著一個發送座號。老師有點喪心病狂，一開始從 1 號開始發送，但是他採用隨機發送，並沒有按著順序發。Po 看到前 K 位同學被這麼發送，Po 認為自己可以發送剩餘的學生編號，而發送方式相當簡單，將剩餘的最小座號發送給當前編號最小 (一開始規定學生編號為 1 - n) 的學生。</p>
<p>K = 4，一開始指派編號給 1 3 5 10 的學生座號，而剩餘座號就是發送順序為 2 4 6 7 8 9。</p>
</blockquote>
<p>Though this is a very good idea, the teacher got mad at Po. So she starts asking the roll number for various students. As there are many students, Po is feeling helpless. Can you help Po?</p>
<h2 id="Input">Input</h2>
<p>First line will contain an integer T (T &lt;= 30), the number of test cases. Each case will start with three integers N (0 &lt; N &lt;= 109), K (0 &lt; K &lt;= 50,000 and K &lt;= N) and Q (0 &lt; Q &lt;= 50,000). N is the total number of students, K is described earlier and Q is the number of queries of the crazy teacher. Next line will contain K distinct integers, the first K roll number assigned by the teacher. These values will be between 1 and 1000000000 (inclusive). Next will be Q integers, each indicating a position of students. These values will be between 1 and N (inclusive). (Large input output file, use faster I/O)</p>
<h2 id="Output">Output</h2>
<p>For each case print one line “Case T:” where T is the case number. Then for each query print one line with the roll number of the student standing on the queried position. See sample I/O for clarity.</p>
<h2 id="Sample_Input">Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">10 4 4</div><div class="line">1 3 5 2</div><div class="line">5 6 9 10</div><div class="line">10 3 2</div><div class="line">10 1 9</div><div class="line">4 10</div></pre></td></tr></table></figure>

<h2 id="Output_for_Sample_Input">Output for Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Case</span> <span class="number">1</span>:</div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">6</span></div><div class="line"><span class="number">9</span></div><div class="line"><span class="number">10</span></div><div class="line"><span class="keyword">Case</span> <span class="number">2</span>:</div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">8</span></div></pre></td></tr></table></figure>

<h2 id="Solution">Solution</h2>
<p><strong> 題目解法：</strong></p>
<p>將沒有分配到的連續區間壓縮，接著對於詢問二分搜索即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;algorithm&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> A[<span class="number">65536</span>], B[<span class="number">65536</span>], C[<span class="number">65536</span>], D[<span class="number">65536</span>];</div><div class="line"><span class="keyword">int</span> main() {</div><div class="line">	<span class="keyword">int</span> testcase, cases = <span class="number">0</span>, N, K, Q;</div><div class="line">	<span class="keyword">int</span> x, l, r;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">	<span class="keyword">while</span>(testcase--) {</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;N, &amp;K, &amp;Q);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= K; i++)</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;A[i]), B[i] = A[i];</div><div class="line">		sort(B + <span class="number">1</span>, B + <span class="number">1</span> + K);</div><div class="line">		B[<span class="number">0</span>] = <span class="number">0</span>, B[K+<span class="number">1</span>] = N + <span class="number">1</span>;</div><div class="line">		<span class="keyword">int</span> M = <span class="number">1</span>;</div><div class="line">		C[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= K + <span class="number">1</span>; i++) {</div><div class="line">			l = B[i - <span class="number">1</span>] + <span class="number">1</span>, r = B[i] - <span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(l &lt;= r) {</div><div class="line">				C[M] = C[M - <span class="number">1</span>] + r - l + <span class="number">1</span>;</div><div class="line">				D[M] = l;</div><div class="line">				M++;</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"Case %d:\n"</span>, ++cases);</div><div class="line">		<span class="keyword">while</span>(Q--) {</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</div><div class="line">			<span class="keyword">if</span>(x &lt;= K)</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, A[x]);</div><div class="line">			<span class="keyword">else</span> {</div><div class="line">				x -= K;</div><div class="line">				<span class="keyword">int</span> pos = lower_bound(C, C + M, x) - C;</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, D[pos] + x - C[pos-<span class="number">1</span>] - <span class="number">1</span>);</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>加速 IO 的做法如下，優化輸入函數，以及反饋的二分搜索，但是排名還是沒有達到想要的目標。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;algorithm&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> A[<span class="number">65536</span>], B[<span class="number">65536</span>], C[<span class="number">65536</span>], D[<span class="number">65536</span>];</div><div class="line"><span class="keyword">inline</span> <span class="keyword">int</span> readchar() {</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</div><div class="line">    <span class="keyword">if</span>(p == end) {</div><div class="line">        <span class="keyword">if</span>((end = buf + fread(buf, <span class="number">1</span>, N, stdin)) == buf) <span class="keyword">return</span> EOF;</div><div class="line">        p = buf;</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> *p++;</div><div class="line">}</div><div class="line"><span class="keyword">inline</span> <span class="keyword">int</span> ReadInt(<span class="keyword">int</span> *x) {</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</div><div class="line">    <span class="keyword">while</span>((c = readchar()) &lt; <span class="string">'-'</span>)    {<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;}</div><div class="line">    neg = (c == <span class="string">'-'</span>) ? -<span class="number">1</span> : <span class="number">1</span>;</div><div class="line">    *x = (neg == <span class="number">1</span>) ? c-<span class="string">'0'</span> : <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>((c = readchar()) &gt;= <span class="string">'0'</span>)</div><div class="line">        *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">'0'</span>;</div><div class="line">    *x *= neg;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> main() {</div><div class="line">	<span class="keyword">int</span> testcase, cases = <span class="number">0</span>, N, K, Q;</div><div class="line">	<span class="keyword">int</span> x, l, r;</div><div class="line">	ReadInt(&amp;testcase);</div><div class="line">	<span class="keyword">while</span>(testcase--) {</div><div class="line">		ReadInt(&amp;N);</div><div class="line">		ReadInt(&amp;K);</div><div class="line">		ReadInt(&amp;Q);</div><div class="line">		<span class="keyword">int</span> *p = A + <span class="number">1</span>, *q = B + <span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= K; i++, p++, q++) {</div><div class="line">			ReadInt(p), *q = *p;</div><div class="line">		}</div><div class="line">		sort(B + <span class="number">1</span>, B + <span class="number">1</span> + K);</div><div class="line">		B[<span class="number">0</span>] = <span class="number">0</span>, B[K+<span class="number">1</span>] = N + <span class="number">1</span>;</div><div class="line">		<span class="keyword">int</span> M = <span class="number">1</span>;</div><div class="line">		C[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">		p = B, q = p+<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= K + <span class="number">1</span>; i++, p = q++) {</div><div class="line">			l = *p + <span class="number">1</span>, r = *q - <span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(l &lt;= r) {</div><div class="line">				C[M] = C[M - <span class="number">1</span>] + r - l + <span class="number">1</span>;</div><div class="line">				D[M] = l;</div><div class="line">				M++;</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"Case %d:\n"</span>, ++cases);</div><div class="line">		<span class="keyword">int</span> prevX = <span class="number">0</span>, prevP = <span class="number">0</span>, pos;</div><div class="line">		<span class="keyword">while</span>(Q--) {</div><div class="line">			ReadInt(&amp;x);</div><div class="line">			<span class="keyword">if</span>(x &lt;= K)</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, A[x]);</div><div class="line">			<span class="keyword">else</span> {</div><div class="line">				x -= K;</div><div class="line">				<span class="keyword">if</span>(x &gt;= prevX)</div><div class="line">					pos = lower_bound(C + prevP, C + M, x) - C;</div><div class="line">				<span class="keyword">else</span></div><div class="line">					pos = lower_bound(C, C + prevP, x) - C;</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, D[pos] + x - C[pos-<span class="number">1</span>] - <span class="number">1</span>);</div><div class="line">				prevX = x, prevP = pos;</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-11031" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/12/oj/uva/uva-11031/" class="article-date">
  <time datetime="2014-06-11T23:40:31.000Z" itemprop="datePublished">Jun 12 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/12/oj/uva/uva-11031/">UVa 11031 - Looking for a Subset</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/12/oj/uva/uva-11031/" data-id="7jbq7nnkfrvaxq4j" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/12/oj/uva/uva-11031/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BIT/">BIT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Greedy/">Greedy</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem">Problem</h2>
<p>Given a set S = { a1, a2, a3, … , an }, you have to find a subset of S, P = { ax1, ax2, ax3, … , axm } such that ( x1 &lt; x2 &lt; … &lt; xm ) and ( ax1&lt; ax2&lt; … &lt; axm ). If there are several subsets possible then you should find the subset where x1 is minimum. If there is still a tie then check for the lowest x2 and so on.</p>
<h2 id="Input">Input</h2>
<p>The input file contains several sets of inputs. The total number of test cases will be less than 25. The description of each set is given below:</p>
<p>Each case starts with two integers n (1 ≤ n ≤ 10000) and q (1 ≤ q ≤ 100), q is the number of queries. The next line contains n integers (seperated by a space) denoting a1, a2, a3, … , an respectively. And the next q lines, each contains an integer denoting m (1 ≤ m ≤ n). There is no number in the input file that contains more than 8 digits.</p>
<p>The input will be terminated by the case where n = q = 0. And this case should not be processed.</p>
<h2 id="Output">Output</h2>
<p>For each case in the input, you should first print the case number starting from 1.<br>Then for each query first print the query number starting from 1. And for each m you have to find the result.<br>If there exists a subset as described above you should print the elements of the subset in a single line. The numbers should be seperated by a space.<br>Otherwise print ``Impossible’’ without the quotes.</p>
<p>See the sample input-output for more details. Output should be formatted like the sample output. </p>
<h2 id="Sample_Input">Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">6 3</div><div class="line">3 4 1 2 3 6</div><div class="line">6</div><div class="line">4</div><div class="line">5</div><div class="line">6 2</div><div class="line">2 4 6 1 3 5</div><div class="line">3</div><div class="line">4</div><div class="line">0 0</div></pre></td></tr></table></figure>


<h2 id="Output_for_Sample_Input">Output for Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Set</span> <span class="number">1</span>:</div><div class="line">  <span class="keyword">Subset</span> <span class="number">1</span>:</div><div class="line">    Impossible</div><div class="line">  <span class="keyword">Subset</span> <span class="number">2</span>:</div><div class="line">    <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">6</span></div><div class="line">  <span class="keyword">Subset</span> <span class="number">3</span>:</div><div class="line">    Impossible</div><div class="line"><span class="keyword">Set</span> <span class="number">2</span>:</div><div class="line">  <span class="keyword">Subset</span> <span class="number">1</span>:</div><div class="line">    <span class="number">2</span> <span class="number">4</span> <span class="number">6</span></div><div class="line">  <span class="keyword">Subset</span> <span class="number">2</span>:</div><div class="line">    Impossible</div></pre></td></tr></table></figure>

<h2 id="Solution">Solution</h2>
<p><strong> 題目描述：</strong></p>
<p>對於每次詢問 m，找到一個嚴格遞增的子序列，並且子序列長度等於 m 且字典順序最小。</p>
<p><strong> 題目解法：</strong></p>
<p>基於每次字典順序最小，只能採用 greedy 的掃描方式，因此對於每次詢問必須到達 O(n)，無法在 O(m) 的時間完成。</p>
<p>關於貪心的操作，建造反向的遞減序列，狀態為 從這個位置為子序列的頭最長的遞減序列長度為何。</p>
<p>為了在 O(n log n) 得到 LDS 表格，這裡使用一個 binary indexed tree 來完成操作。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt; </span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;algorithm&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;map&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> maxN 10005</span></div><div class="line"><span class="keyword">int</span> A[maxN], LDS[maxN];</div><div class="line"><span class="keyword">int</span> BIT[maxN];</div><div class="line"><span class="keyword">void</span> modify(<span class="keyword">int</span> i, <span class="keyword">int</span> val, <span class="keyword">int</span> L) {</div><div class="line">	<span class="keyword">while</span>(i &lt;= L) {</div><div class="line">		BIT[i] = max(BIT[i], val);</div><div class="line">		i += i&amp;(-i);</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="keyword">int</span> query(<span class="keyword">int</span> i) {</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span>(i) {</div><div class="line">		ret = max(ret, BIT[i]);</div><div class="line">		i -= i&amp;(-i);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">}</div><div class="line"><span class="keyword">inline</span> <span class="keyword">int</span> readchar() {</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1048576</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> buf[N];</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> *p = buf, *end = buf;</div><div class="line">    <span class="keyword">if</span>(p == end) {</div><div class="line">        <span class="keyword">if</span>((end = buf + fread(buf, <span class="number">1</span>, N, stdin)) == buf) <span class="keyword">return</span> EOF;</div><div class="line">        p = buf;</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> *p++;</div><div class="line">}</div><div class="line"><span class="keyword">inline</span> <span class="keyword">int</span> ReadInt(<span class="keyword">int</span> *x) {</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> c, neg;</div><div class="line">    <span class="keyword">while</span>((c = readchar()) &lt; <span class="string">'-'</span>)    {<span class="keyword">if</span>(c == EOF) <span class="keyword">return</span> <span class="number">0</span>;}</div><div class="line">    neg = (c == <span class="string">'-'</span>) ? -<span class="number">1</span> : <span class="number">1</span>;</div><div class="line">    *x = (neg == <span class="number">1</span>) ? c-<span class="string">'0'</span> : <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>((c = readchar()) &gt;= <span class="string">'0'</span>)</div><div class="line">        *x = (*x &lt;&lt; <span class="number">3</span>) + (*x &lt;&lt; <span class="number">1</span>) + c-<span class="string">'0'</span>;</div><div class="line">    *x *= neg;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> main() {</div><div class="line">	<span class="keyword">int</span> N, Q, M, u;</div><div class="line">	<span class="keyword">int</span> cases = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span>(ReadInt(&amp;N) &amp;&amp; ReadInt(&amp;Q) &amp;&amp; N+Q) {</div><div class="line">		<span class="stl_container"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;</span> R;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) {</div><div class="line">			ReadInt(A+i);</div><div class="line">			R[A[i]] = <span class="number">0</span>;</div><div class="line">		}</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</div><div class="line">			BIT[i] = <span class="number">0</span>;</div><div class="line">			</div><div class="line">		<span class="keyword">int</span> size = R.size();</div><div class="line">		<span class="keyword">for</span>(<span class="stl_container"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;</span>::iterator it = R.begin();</div><div class="line">			it != R.end(); it++) {</div><div class="line">			it-&gt;second = size--;</div><div class="line">		}</div><div class="line">		<span class="comment">/* reverse LDS with ending at i-th element */</span></div><div class="line">		<span class="keyword">int</span> maxLDS = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = N-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) {</div><div class="line">			LDS[i] = query((u = R[A[i]]) - <span class="number">1</span>) + <span class="number">1</span>;</div><div class="line">			modify(u, LDS[i], R.size());</div><div class="line">			maxLDS = max(maxLDS, LDS[i]);</div><div class="line">		}</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"Set %d:\n"</span>, ++cases);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Q; i++) {</div><div class="line">			ReadInt(&amp;M);</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"  Subset %d:\n"</span>, i);</div><div class="line">			<span class="keyword">if</span>(M &gt; maxLDS) {</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"    Impossible\n"</span>);</div><div class="line">				<span class="keyword">continue</span>;</div><div class="line">			}</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"   "</span>);</div><div class="line">			<span class="keyword">int</span> prevA = -<span class="number">0x3f3f3f3f</span>;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N &amp;&amp; M; j++) {</div><div class="line">				<span class="keyword">if</span>(LDS[j] &gt;= M &amp;&amp; prevA &lt; A[j]) {</div><div class="line">					<span class="built_in">printf</span>(<span class="string">" %d"</span>, A[j]);</div><div class="line">					M--, prevA = A[j];</div><div class="line">				}</div><div class="line">			}</div><div class="line">			<span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-11638" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/10/oj/uva/uva-11638/" class="article-date">
  <time datetime="2014-06-10T00:04:39.000Z" itemprop="datePublished">Jun 10 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/10/oj/uva/uva-11638/">UVa 11638 - Temperature Monitoring</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/10/oj/uva/uva-11638/" data-id="udgwl29h8wfsxv58" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/10/oj/uva/uva-11638/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/模擬/">模擬</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem">Problem</h2>
<p>We have a device to monitor temperature. After configuring it, we place it inside the chamber whose temperature we wish to monitor. The device is equipped with four alarms each of which can be configured differently. The Alarms are identified by the numbers 1, 2, 3 and 4.  The device takes a reading of its surrounding at a regular interval.</p>
<p>In this problem you will be simulating the behavior of such a device.</p>
<blockquote>
<p>我們有一個監測溫度裝置，在安裝配置後，將其放入所要監控溫度的室內。這個裝置共有四個警報器，分別編號為 1, 2, 3, 4，這些警報器將會每隔固定一段時間進行溫度檢測。<br>在這個問題中，請模擬這裝置的行為。</p>
</blockquote>
<h2 id="Input">Input</h2>
<p>The first line of input contains a positive integer T&lt;101, which denotes the number of test cases. Each case consists of several lines which are described below. </p>
<blockquote>
<p>輸入第一行為測資筆數 T (T &lt; 101)</p>
</blockquote>
<p>The first line contains a positive integer M, which denotes the measurement interval. That is, the device takes a reading every M seconds. </p>
<blockquote>
<p>每一組測資第一行為一個正整數 M，表示裝置每隔 M 秒會進行偵測。</p>
</blockquote>
<p>The second line contains a non-negative integer S, which denotes the ‘Startup delay’. This is the amount of time that the device will remain idle after placing inside the chamber before it takes its first reading. The device will instantly take a reading when the ‘Startup delay’ ends.</p>
<blockquote>
<p>第二行為一個非負整數 S，表示裝置在前 S 秒正在安裝，這段時間機器將不會進行偵測，在安裝完後，將會立即地進行檢測。</p>
</blockquote>
<p>The third line contains four integers. The integers give the threshold temperature for alarm 1,2,3,4 respectively. Here threshold temperature means, when a recorded temperature crosses this temperature the corresponding alarm will be triggered.</p>
<blockquote>
<p>第三行會有 4 個正整數，分別表示警報器 1, 2, 3, 4 的警報閥值 (根據閥值進行溫度比較)</p>
</blockquote>
<p>The fourth line contains a non-negative integer C. The least significant 8 bits of this integer represents the configurations of the four alarms. The rightmost 4 bits (bit 0 to 3) determine if the alarms are enabled(bit value 1) or disabled(bit value 0). For example, if the bits are set as 0011, this means Alarm 1 and 2 are enabled and Alarm 3 and 4 are disabled. If an alarm is disabled, it will never be triggered.</p>
<blockquote>
<p>第四行將會有一個非負整數 C，用最低的 8 個 bits 表示警報器的設定，最右邊的 4 個 bits (bit 0 to bit 3) 表示警報器是否有啟動 (1 表示有啟動，反之則否)，例如 0011 表示警報器 1, 2 被啟動，3, 4 則沒有被啟動。如果警報器沒有被啟動，則將不會被觸發。</p>
</blockquote>
<p>The next 4 bits(bits 4 to 7) determine the triggering type of each alarm. A value of 0 means, it’s a low trigger and a value of 1 means it’s a high trigger. For example, if the bits are set as 1100, this means Alarm 1 and 2 are set for low trigger and Alarm 3 and 4 for high trigger. Here high trigger means if a recorded temperature is above the set threshold temperature for an alarm, it will be triggered. Similarly, a Low trigger means if a recorded temperature is below the set threshold temperature for an alarm, that alarm will be triggered.</p>
<blockquote>
<p>接下來的 4 個 bits 將會決定警報器的類型，亦即表示 1 高觸發 (大於閥值觸發) 0 表示低觸發 (低於閥值觸發)。例如 1100，警報器 1, 2 將會是低觸發，3, 4 則會是高觸發。</p>
</blockquote>
<p>The fifth line contains a positive integer K&lt;=100. The following K lines contain a pair of integers each in the format time temp. Here time represents the duration of a period with constant temperature and temp indicates the temperature of the environment in that period. Note that, time is always positive. The time value of first pair indicates the period immediately following the placement of the device inside the environment to be monitored. Successive time values indicate the duration of periods in the order they occur. The temperature at the border regions is considered to be that of the period just ending. Also, the temperature at the very beginning is that of the first period. Every value in the input will fit in 32 bit signed integer.</p>
<blockquote>
<p>第五行將會有一個正整數 K，表示接下來依序發生的時間情況。將會從時間 0 開始，依序播報 (duration, temp) 表示新的溫度持續多久 (duration)。假設所有數據皆可以在 32 bits 內。</p>
</blockquote>
<h2 id="Output">Output</h2>
<p>For each case of input, there will be one line of output. It will first contain the case number, followed by the triggering status of each of the four alarms. The triggering status will contain four strings of either yes or no, separated by a space. The first string will be yes if alarm 1 was triggered at least once and no otherwise. The second string will be the status of alarm 2 and so on. Look at the sample output for exact formatting.</p>
<h2 id="Sample_Input">Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">2</div><div class="line">5</div><div class="line">5</div><div class="line">5 10 15 20</div><div class="line">15</div><div class="line">1</div><div class="line">5 15</div><div class="line">1</div><div class="line">0</div><div class="line">5 10 15 20</div><div class="line">7</div><div class="line">2</div><div class="line">10 15</div><div class="line">10 20</div></pre></td></tr></table></figure>

<h2 id="Output_for_Sample_Input">Output for Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="title">Case</span> <span class="number">1</span>: <span class="built_in">no</span> <span class="built_in">no</span> <span class="built_in">no</span> <span class="built_in">yes</span></div><div class="line">Case <span class="number">2</span>: <span class="built_in">no</span> <span class="built_in">no</span> <span class="built_in">no</span> <span class="built_in">no</span></div></pre></td></tr></table></figure>


<h2 id="Solution">Solution</h2>
<p>題目相當令人討厭，因為區間涵蓋沒有講得很清楚。</p>
<p>但是最後可以明白的是</p>
<blockquote>
<p>[ti, tj][tj, tk] 其中 ti &lt; tj &lt; tk，我們在討論觸發的時候，端點是需要被考慮的。</p>
</blockquote>
<p>詳細操作，詳見代碼。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt; </span></div><div class="line"></div><div class="line"><span class="keyword">int</span> main() {</div><div class="line">	<span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> M; <span class="comment">/* the device takes a reading every M seconds. */</span></div><div class="line">	<span class="keyword">int</span> S; <span class="comment">/* The device will instantly take a reading when the ‘Startup delay’ ends. */</span></div><div class="line">	<span class="keyword">int</span> threshold[<span class="number">4</span>]; <span class="comment">/* */</span></div><div class="line">	<span class="keyword">int</span> C; <span class="comment">/* */</span></div><div class="line">	<span class="keyword">int</span> enable[<span class="number">4</span>], trigger[<span class="number">4</span>]; <span class="comment">/* trigger 0 &lt;, 1 &gt; */</span></div><div class="line">	<span class="keyword">int</span> K, time, temp;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">	<span class="keyword">while</span>(testcase--) {</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;M);</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;S);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;threshold[i]);</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;C);</div><div class="line">		</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</div><div class="line">			enable[i] = (C&gt;&gt;i)&amp;<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">4</span>; i &lt; <span class="number">8</span>; i++)</div><div class="line">			trigger[i - <span class="number">4</span>] = (C&gt;&gt;i)&amp;<span class="number">1</span>;</div><div class="line">		</div><div class="line">		<span class="keyword">int</span> result[<span class="number">4</span>] = {};</div><div class="line">		<span class="keyword">int</span> now_time = <span class="number">0</span>, L, R;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;K);</div><div class="line">		<span class="keyword">while</span>(K--) {</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;time, &amp;temp);</div><div class="line">			L = now_time;</div><div class="line">			R = now_time + time;</div><div class="line">			<span class="keyword">if</span>(R &lt; S) {</div><div class="line">				</div><div class="line">			} <span class="keyword">else</span> {</div><div class="line">				<span class="keyword">int</span> last_read = R / M * M;</div><div class="line">				<span class="keyword">if</span>(L &lt;= last_read &amp;&amp; last_read &lt;= R &amp;&amp; last_read &gt;= S) {</div><div class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) {</div><div class="line">						<span class="keyword">if</span>(trigger[i] == <span class="number">0</span>) {</div><div class="line">							result[i] |= (temp &lt; threshold[i])&amp;enable[i];</div><div class="line">						} <span class="keyword">else</span> {</div><div class="line">							result[i] |= (temp &gt; threshold[i])&amp;enable[i];</div><div class="line">						}</div><div class="line">					}</div><div class="line">				}</div><div class="line">			}</div><div class="line">			now_time = R;</div><div class="line">		}</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"Case %d:"</span>, ++cases);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</div><div class="line">			<span class="built_in">printf</span>(<span class="string">" %s"</span>, result[i] ? <span class="string">"yes"</span> : <span class="string">"no"</span>);</div><div class="line">		<span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"> </div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-10709" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/08/oj/uva/uva-10709/" class="article-date">
  <time datetime="2014-06-08T08:54:39.000Z" itemprop="datePublished">Jun 8 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/08/oj/uva/uva-10709/">UVa 10709 - Intersection is Not that Easy</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/08/oj/uva/uva-10709/" data-id="fonhmj7vctq1adqj" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/08/oj/uva/uva-10709/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/幾何/">幾何</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/線段交/">線段交</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem">Problem</h2>
<p>In this problem your job is to find the distance between two lines or a line and a line segment or two line segments. Suppose we have two points A(x1,y1) and B(x2,y2) on a two dimensional Cartesian plane. If we connect A and B then we get line segment AB. But if we connect AB and extend it on both side at infinite length then we get line AB.</p>
<h2 id="Input">Input</h2>
<p>The input file contains several sets of inputs. The description of each set of input is given below:</p>
<p>The description for each set of input is given in two lines. Each line contains four integers and a string. First line contains x1, y1, x2, y2 and S1 and the second line contains x3, y3, x4, y4 and S2. The value of S1 and S2 can be either “L” or “LS” which stands for “Line” and “Line-segment” respectively. (x1, y1) and (x2, y2) are the endpoints of first line segment or they are just two different points on the first line depending on the value of S1. The same story applies for the second input line for this set. Input is terminated by a set where the value of S1 and S1 is “END”. This set should not be processed. Point (x1,y1) and (x2,y2) are always different. Similarly point (x3,y3) and (x4,y4) are also always different. All the integers in the input file have absolute value less than 101.</p>
<h2 id="Output">Output</h2>
<p>For each set of input you should produce one line of output which contains a single floating-point number indicating the distance between the two lines or line segments or the distance between one line and one line segment. This floating-point number contains five digits after the decimal point. Errors less than 2e-5 will be ignored.</p>
<h2 id="Sample_Input">Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="number">10</span> <span class="number">10</span> <span class="number">20</span> <span class="number">20</span> L</div><div class="line">-<span class="number">10</span> –<span class="number">10</span> <span class="number">19</span> <span class="number">19</span> L</div><div class="line"><span class="number">10</span> <span class="number">10</span> <span class="number">12</span> <span class="number">13</span> LS</div><div class="line"><span class="number">11</span> <span class="number">11</span> <span class="number">19</span> <span class="number">20</span> LS</div><div class="line"><span class="number">10</span> <span class="number">10</span> <span class="number">12</span> <span class="number">12</span> <span class="keyword">END</span></div><div class="line"><span class="number">11</span> <span class="number">11</span> <span class="number">23</span> <span class="number">34</span> <span class="keyword">END</span></div></pre></td></tr></table></figure>

<h2 id="Output_for_Sample_Input">Output for Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">0.00000</div><div class="line">0.27735</div></pre></td></tr></table></figure>

<h2 id="Solution">Solution</h2>
<p><strong> 題目描述： </strong></p>
<p>詢問 線段/線 和 線段/線 之間的最短距離為何。</p>
<p><strong> 題目解法： </strong></p>
<p>據說這一題精準度卡很緊，上一次是在兩年前寫這一題，那是使用投影判斷，果真死在精度？</p>
<p>總之，為了避開投影精準度問題，使用外積和內積來判斷我們所有需要的條件。</p>
<ul>
<li>兩線斷是否相交</li>
<li>一個點是否在線段兩端點之間 (線段上方/下方)</li>
<li>是否在線段上</li>
</ul>
<p>以上三點接能只靠加減乘來完成，由於輸入值都是整數，不會有精度上的問題。</p>
<p>接著，個別討論所有配對情況要如何判斷。</p>
<ul>
<li>線段與線段<ul>
<li>相交，最鄰近距離 0。</li>
<li>不相交，查閱是否能作投影，否則直接查閱到端點的距離。</li>
</ul>
</li>
<li>線與線<ul>
<li>不平行，最鄰近距離 0。</li>
<li>平行，直接調用公式計算兩線距離。 // 當然可以調用投影距離。</li>
</ul>
</li>
<li>線與線段<ul>
<li>線段跨過線的兩側，最鄰近距離 0</li>
<li>同側，直接做投影。</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt; </span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;math.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;algorithm&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="preprocessor">#<span class="keyword">define</span> eps 1e-6</span></div><div class="line"><span class="keyword">struct</span> Pt {</div><div class="line">    <span class="keyword">int</span> x, y;</div><div class="line">    Pt(<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>):</div><div class="line">    	x(a), y(b) {}</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> {</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">fabs</span>(x-a.x) &gt; eps)</div><div class="line">            <span class="keyword">return</span> x &lt; a.x;</div><div class="line">        <span class="keyword">return</span> y &lt; a.y;</div><div class="line">    }</div><div class="line">	Pt <span class="keyword">operator</span>-(<span class="keyword">const</span> Pt &amp;a) <span class="keyword">const</span> {</div><div class="line">		Pt ret;</div><div class="line">		ret.x = x - a.x;</div><div class="line">		ret.y = y - a.y;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    }</div><div class="line">};</div><div class="line"><span class="keyword">enum</span> LINE_TYPE {LINE, SEGMENT};</div><div class="line"><span class="keyword">struct</span> LINE2D {</div><div class="line">    Pt s, e;</div><div class="line">    LINE_TYPE type;</div><div class="line">};</div><div class="line"><span class="keyword">double</span> dist(Pt a, Pt b) {</div><div class="line">	<span class="keyword">return</span> hypot(a.x - b.x, a.y - b.y);</div><div class="line">}</div><div class="line"><span class="keyword">double</span> dot(Pt a, Pt b) {</div><div class="line">	<span class="keyword">return</span> a.x * b.x + a.y * b.y;</div><div class="line">}</div><div class="line"><span class="keyword">double</span> cross2(Pt a, Pt b) {</div><div class="line">	<span class="keyword">return</span> a.x * b.y - a.y * b.x;</div><div class="line">}</div><div class="line"><span class="keyword">double</span> cross(Pt o, Pt a, Pt b) {</div><div class="line">    <span class="keyword">return</span> (a.x-o.x)*(b.y-o.y)-(a.y-o.y)*(b.x-o.x);</div><div class="line">}</div><div class="line"><span class="keyword">int</span> between(Pt a, Pt b, Pt c) {</div><div class="line">	<span class="keyword">return</span> dot(c - a, b - a) &gt;= <span class="number">0</span> &amp;&amp; dot(c - b, a - b) &gt;= <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> onSeg(Pt a, Pt b, Pt c) {</div><div class="line">	<span class="keyword">return</span> between(a, b, c) &amp;&amp; <span class="built_in">fabs</span>(cross(a, b, c)) &lt; eps;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> intersection(Pt as, Pt at, Pt bs, Pt bt) {</div><div class="line">    <span class="keyword">if</span>(cross(as, at, bs) * cross(as, at, bt) &lt; <span class="number">0</span> &amp;&amp;</div><div class="line">       cross(at, as, bs) * cross(at, as, bt) &lt; <span class="number">0</span> &amp;&amp;</div><div class="line">       cross(bs, bt, as) * cross(bs, bt, at) &lt; <span class="number">0</span> &amp;&amp;</div><div class="line">       cross(bt, bs, as) * cross(bt, bs, at) &lt; <span class="number">0</span>)</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="keyword">double</span> distProjection(Pt as, Pt at, Pt s) {</div><div class="line">	<span class="keyword">int</span> a, b, c;</div><div class="line">	a = at.y - as.y;</div><div class="line">	b = as.x - at.x;</div><div class="line">	c = - (a * as.x + b * as.y);</div><div class="line">	<span class="keyword">return</span> <span class="built_in">fabs</span>(a * s.x + b * s.y + c) / hypot(a, b);</div><div class="line">}</div><div class="line"><span class="keyword">double</span> closest(LINE2D l1, LINE2D l2) {</div><div class="line">	<span class="keyword">if</span>(l1.type == SEGMENT &amp;&amp; l2.type == SEGMENT) {</div><div class="line">		<span class="keyword">if</span>(intersection(l1.s, l1.e, l2.s, l2.e))</div><div class="line">			<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		<span class="keyword">double</span> c = <span class="number">1e+30</span>;</div><div class="line">		<span class="keyword">if</span>(between(l1.s, l1.e, l2.s))</div><div class="line">			c = min(c, distProjection(l1.s, l1.e, l2.s));</div><div class="line">		<span class="keyword">else</span></div><div class="line">			c = min(c, min(dist(l1.s, l2.s), dist(l1.e, l2.s)));</div><div class="line">			</div><div class="line">		<span class="keyword">if</span>(between(l1.s, l1.e, l2.e))</div><div class="line">			c = min(c, distProjection(l1.s, l1.e, l2.e));</div><div class="line">		<span class="keyword">else</span></div><div class="line">			c = min(c, min(dist(l1.s, l2.e), dist(l1.e, l2.e)));</div><div class="line">		<span class="comment">/* opposite */</span></div><div class="line">		<span class="keyword">if</span>(between(l2.s, l2.e, l1.s))</div><div class="line">			c = min(c, distProjection(l2.s, l2.e, l1.s));</div><div class="line">		<span class="keyword">else</span></div><div class="line">			c = min(c, min(dist(l1.s, l2.s), dist(l1.e, l2.s)));</div><div class="line">			</div><div class="line">		<span class="keyword">if</span>(between(l2.s, l2.e, l1.e))</div><div class="line">			c = min(c, distProjection(l2.s, l2.e, l1.e));</div><div class="line">		<span class="keyword">else</span></div><div class="line">			c = min(c, min(dist(l2.s, l1.e), dist(l2.e, l1.e)));</div><div class="line">		<span class="keyword">return</span> c;</div><div class="line">	}</div><div class="line">	<span class="keyword">if</span>(l1.type == LINE &amp;&amp; l2.type == LINE) {</div><div class="line">		<span class="keyword">int</span> a1, a2, b1, b2, c1, c2;</div><div class="line">		a1 = l1.s.y - l1.e.y;</div><div class="line">		b1 = l1.e.x - l1.s.x;</div><div class="line">		c1 = - (a1 * l1.s.x + b1 * l1.s.y);</div><div class="line">		a2 = l2.s.y - l2.e.y;</div><div class="line">		b2 = l2.e.x - l2.s.x;</div><div class="line">		c2 = - (a2 * l2.s.x + b2 * l2.s.y);</div><div class="line">		<span class="keyword">if</span>(a1 * b2 - a2 * b1 != <span class="number">0</span>)</div><div class="line">			<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		<span class="keyword">return</span> distProjection(l1.s, l1.e, l2.s);</div><div class="line">	}</div><div class="line">	<span class="keyword">if</span>(l1.type != l2.type) {</div><div class="line">		<span class="keyword">if</span>(l1.type == SEGMENT)</div><div class="line">			swap(l1, l2);</div><div class="line">		<span class="comment">/* l1 LINE, l2 SEGMENT*/</span></div><div class="line">		<span class="keyword">int</span> a1, b1, c1;</div><div class="line">		a1 = l1.s.y - l1.e.y;</div><div class="line">		b1 = l1.e.x - l1.s.x;</div><div class="line">		c1 = - (a1 * l1.s.x + b1 * l1.s.y);</div><div class="line">		<span class="keyword">int</span> v1, v2;</div><div class="line">		v1 = a1 * l2.s.x + b1 * l2.s.y + c1;</div><div class="line">		v2 = a1 * l2.e.x + b1 * l2.e.y + c1;</div><div class="line">		<span class="keyword">if</span>(v1 * v2 &lt;= <span class="number">0</span>)</div><div class="line">			<span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// different side</span></div><div class="line">		<span class="keyword">return</span> min(distProjection(l1.s, l1.e, l2.s), distProjection(l1.s, l1.e, l2.e));</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> main() {</div><div class="line">	<span class="comment">// freopen("in.txt", "r+t", stdin);</span></div><div class="line">	<span class="comment">// freopen("out.txt", "w+t", stdout); </span></div><div class="line">	<span class="keyword">int</span> x1, x2, y1, y2;</div><div class="line">	LINE2D l1, l2;</div><div class="line">	<span class="keyword">char</span> s[<span class="number">1024</span>];</div><div class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d %s"</span>, &amp;x1, &amp;y1, &amp;x2, &amp;y2, s) == <span class="number">5</span> &amp;&amp; s[<span class="number">0</span>] != <span class="string">'E'</span>) {</div><div class="line">		l1.s = Pt(x1, y1), l1.e = Pt(x2, y2);</div><div class="line">		<span class="keyword">if</span>(!<span class="built_in">strcmp</span>(<span class="string">"L"</span>, s))</div><div class="line">			l1.type = LINE;</div><div class="line">		<span class="keyword">else</span></div><div class="line">			l1.type = SEGMENT;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d %d %d %d %s"</span>, &amp;x1, &amp;y1, &amp;x2, &amp;y2, s);</div><div class="line">		l2.s = Pt(x1, y1), l2.e = Pt(x2, y2);</div><div class="line">		<span class="keyword">if</span>(!<span class="built_in">strcmp</span>(<span class="string">"L"</span>, s))</div><div class="line">			l2.type = LINE;</div><div class="line">		<span class="keyword">else</span></div><div class="line">			l2.type = SEGMENT;</div><div class="line">		<span class="keyword">double</span> ret = closest(l1, l2);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%.5lf\n"</span>, ret);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="comment">/*</span></div><div class="line">10 10 20 20 L</div><div class="line">-10 -10 19 19 L</div><div class="line"></div><div class="line">10 10 12 13 LS</div><div class="line">11 11 19 20 LS</div><div class="line"></div><div class="line">1 1 2 2 LS</div><div class="line">3 3 4 4 LS</div><div class="line"></div><div class="line">1 1 2 2 LS</div><div class="line">3 3 4 4 L</div><div class="line"></div><div class="line">10 10 12 12 END</div><div class="line">11 11 23 34 END</div><div class="line">*/</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/UVa-11585" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/04/oj/uva/UVa-11585/" class="article-date">
  <time datetime="2014-06-04T00:28:01.000Z" itemprop="datePublished">Jun 4 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/04/oj/uva/UVa-11585/">UVa 11585 - Nurikabe</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/04/oj/uva/UVa-11585/" data-id="54qq01pvsyu2ygwh" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/04/oj/uva/UVa-11585/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bfs/">bfs</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem">Problem</h2>
<p>At least it’s not a sudoku problem</p>
<p>The puzzle Nurikabe is played on a grid. Initially, each grid space is either blank or contains a single number. The goal is to shade in some of the blank spaces to satisfy the following constraints:</p>
<ul>
<li>Any two shaded spaces are connected by some sequence of adjacent shaded spaces. Two spaces are called adjacent if they share a side.</li>
<li>For each of the unshaded spaces b, let Wb be the collection of all unshaded spaces that can be reached from b by a sequence of adjacent unshaded spaces. Then, Wb contains exactly one numbered space and that number is exactly the number of spaces in Wb.</li>
<li>For any unshaded space b, there is a sequence of unshaded spaces starting at b and ending at a space on the edge of the grid where consecutive spaces in this sequence share a side or a corner.</li>
<li>Finally, in every 2 x 2 subsquare there is at least one unshaded space. </li>
</ul>
<p>The image shows an example of a Nurikabe puzzle and its solution. Take care to verify all four constraints are satisfied in the solution. To help you understand the third constraint, note that the middle cell containing the number 1 can reach the edge of the grid since it shares a corner with a group of unshaded spaces containing the number 2.</p>
<p><img class="lazy" data-original="/img/p11585b.png" alt="Example Nurikabe"></p>
<p>It is known that the problem of determining if a Nurikabe grid can be shaded to satisfy the constraints is NP-complete. Your task is much easier. Given an initial grid and a proposed shading, determine if the shading satisfies the constraints of the Nurikabe puzzle.</p>
<p>Input begins with a single integer t that indicates the number of grids to verify. The first line of each case contains three integers r,c,d where the grid has r rows and c columns (1 ≤ r,c ≤ 100). Then, d lines follow, each containing three integers r’,c’,n meaning the grid cell at location (r’,c’) contains the positive number n. The upper-left grid space has coordinates (0,0), no space receives more than one number, and no two numbered grid spaces will share an edge. Finally, the shading data is specified by r strings of c characters each (one string per line). The j’th character in the i’th row of the shading data is ‘#’ if the cell with coordinates (i,j) is shaded and ‘.’ if that cell is not shaded. Each test case is preceded by a blank line.</p>
<p>For each input case, output a line containing either solved or not solved to indicate whether or not the shading represents a solution to the puzzle.</p>
<h2 id="Sample_input">Sample input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="number">5</span></div><div class="line"></div><div class="line"><span class="number">5</span> <span class="number">5</span> <span class="number">6</span></div><div class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">3</span></div><div class="line"><span class="number">0</span> <span class="number">2</span> <span class="number">1</span></div><div class="line"><span class="number">0</span> <span class="number">4</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line"><span class="number">3</span> <span class="number">4</span> <span class="number">2</span></div><div class="line"><span class="number">4</span> <span class="number">0</span> <span class="number">2</span></div><div class="line">.<span class="comment">#.#.</span></div><div class="line">.<span class="comment">###.</span></div><div class="line">.<span class="comment">#.##</span></div><div class="line"><span class="comment">###..</span></div><div class="line">..<span class="comment">###</span></div><div class="line"></div><div class="line"><span class="number">5</span> <span class="number">5</span> <span class="number">6</span></div><div class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">3</span></div><div class="line"><span class="number">0</span> <span class="number">2</span> <span class="number">1</span></div><div class="line"><span class="number">0</span> <span class="number">4</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line"><span class="number">3</span> <span class="number">4</span> <span class="number">3</span></div><div class="line"><span class="number">4</span> <span class="number">0</span> <span class="number">2</span></div><div class="line">.<span class="comment">#.#.</span></div><div class="line">.<span class="comment">###.</span></div><div class="line">.<span class="comment">#.##</span></div><div class="line"><span class="comment">####.</span></div><div class="line">..<span class="comment">#..</span></div><div class="line"></div><div class="line"><span class="number">2</span> <span class="number">3</span> <span class="number">1</span></div><div class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">2</span></div><div class="line">.<span class="comment">##</span></div><div class="line">.<span class="comment">##</span></div><div class="line"></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">1</span></div><div class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span></div><div class="line">..</div><div class="line"><span class="comment">##</span></div><div class="line"></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">2</span></div><div class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span></div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">1</span></div><div class="line">.<span class="comment">#</span></div><div class="line"><span class="comment">#.</span></div></pre></td></tr></table></figure>

<h2 id="Sample_output">Sample output</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">solved</div><div class="line"><span class="keyword">not</span> solved</div><div class="line"><span class="keyword">not</span> solved</div><div class="line"><span class="keyword">not</span> solved</div><div class="line"><span class="keyword">not</span> solved</div></pre></td></tr></table></figure>

<h2 id="Solution">Solution</h2>
<p><strong> 題目描述： </strong></p>
<ul>
<li>所有陰影區域會相連 (上下左右)</li>
<li>每一個區域的數字，會恰好等於該區域的非陰影個數。</li>
<li>所有非陰影的區域，皆可以連到遊戲盤面的四邊 (九宮格連接)</li>
<li>任意 2x2 區域，至少有一個非陰影的區域。</li>
</ul>
<p><strong> 題目解法： </strong></p>
<p>能剪枝就剪枝，不然很容易 TLE。討論版面上說 DFS 比 BFS 快一些。但這裡還是用 BFS 完成。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;queue&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> g[<span class="number">205</span>][<span class="number">205</span>], ug[<span class="number">205</span>][<span class="number">205</span>];</div><div class="line"><span class="keyword">char</span> pattern[<span class="number">205</span>][<span class="number">205</span>];</div><div class="line"><span class="keyword">int</span> cond1(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> r, <span class="keyword">int</span> c, <span class="keyword">int</span> cellcnt) {</div><div class="line"><span class="comment">/* </span></div><div class="line"> Any two shaded spaces are connected by some sequence </div><div class="line"> of adjacent shaded spaces. Two spaces are called </div><div class="line"> adjacent if they share a side. </div><div class="line">*/</div><div class="line">    <span class="keyword">int</span> dx[] = {<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>};</div><div class="line">    <span class="keyword">int</span> dy[] = {<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>};</div><div class="line">    <span class="stl_container"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;</span> X, Y;</div><div class="line">    <span class="keyword">int</span> i, tx, ty;</div><div class="line">    <span class="keyword">char</span> used[<span class="number">205</span>][<span class="number">205</span>] = {};</div><div class="line">    X.push(x), Y.push(y);</div><div class="line">    used[x][y] = <span class="number">1</span>;</div><div class="line">    cellcnt--;</div><div class="line">    <span class="keyword">while</span>(!X.empty()) {</div><div class="line">        x = X.front(), X.pop();</div><div class="line">        y = Y.front(), Y.pop();</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) {</div><div class="line">            tx = x+dx[i], ty = y+dy[i];</div><div class="line">            <span class="keyword">if</span>(tx &lt; <span class="number">0</span> || ty &lt; <span class="number">0</span> || tx &gt;= r || ty &gt;= c)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">if</span>(used[tx][ty] == <span class="number">0</span> &amp;&amp; pattern[tx][ty] == <span class="string">'#'</span>) {</div><div class="line">                used[tx][ty] = <span class="number">1</span>;</div><div class="line">                cellcnt--;</div><div class="line">                <span class="keyword">if</span>(cellcnt &lt; <span class="number">0</span>)	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">                X.push(tx), Y.push(ty);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> cellcnt == <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> cond2(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> r, <span class="keyword">int</span> c) {</div><div class="line"><span class="comment">/*</span></div><div class="line"> For each of the unshaded spaces b, let Wb be the </div><div class="line"> collection of all unshaded spaces that can be </div><div class="line"> reached from b by a sequence of adjacent unshaded </div><div class="line"> spaces. Then, Wb contains exactly one numbered </div><div class="line"> space and that number is exactly the number of </div><div class="line"> spaces in Wb. </div><div class="line">*/</div><div class="line">    <span class="keyword">int</span> dx[] = {<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>};</div><div class="line">    <span class="keyword">int</span> dy[] = {<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>};</div><div class="line">    <span class="stl_container"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;</span> X, Y;</div><div class="line">    <span class="keyword">int</span> Wb = g[x][y], i, tx, ty;</div><div class="line">    <span class="keyword">char</span> used[<span class="number">205</span>][<span class="number">205</span>] = {};</div><div class="line">    <span class="keyword">if</span>(pattern[x][y] == <span class="string">'.'</span>) {</div><div class="line">        X.push(x), Y.push(y);</div><div class="line">        used[x][y] = <span class="number">1</span>;</div><div class="line">    } <span class="keyword">else</span></div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    Wb--;</div><div class="line">    <span class="keyword">while</span>(!X.empty()) {</div><div class="line">        x = X.front(), X.pop();</div><div class="line">        y = Y.front(), Y.pop();</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) {</div><div class="line">            tx = x+dx[i], ty = y+dy[i];</div><div class="line">            <span class="keyword">if</span>(tx &lt; <span class="number">0</span> || ty &lt; <span class="number">0</span> || tx &gt;= r || ty &gt;= c)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">if</span>(used[tx][ty] == <span class="number">0</span> &amp;&amp; pattern[tx][ty] == <span class="string">'.'</span>) {</div><div class="line">                <span class="comment">// if(ug[tx][ty]) return 0; // other Wb</span></div><div class="line">                used[tx][ty] = <span class="number">1</span>;</div><div class="line">                Wb--;</div><div class="line">                <span class="keyword">if</span>(Wb &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">                X.push(tx), Y.push(ty);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> Wb == <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> cond3(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> r, <span class="keyword">int</span> c) {</div><div class="line"><span class="comment">/*</span></div><div class="line">  For any unshaded space b, there is a sequence </div><div class="line">  of unshaded spaces starting at b and ending </div><div class="line">  at a space on the edge of the grid where </div><div class="line">  consecutive spaces in this sequence share a </div><div class="line">  side or a corner. </div><div class="line">*/</div><div class="line">    <span class="keyword">int</span> dx[] = {<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>};</div><div class="line">    <span class="keyword">int</span> dy[] = {<span class="number">1</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, -<span class="number">1</span>};</div><div class="line">    <span class="stl_container"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;</span> X, Y;</div><div class="line">    <span class="keyword">int</span> i, tx, ty;</div><div class="line">    <span class="keyword">char</span> used[<span class="number">205</span>][<span class="number">205</span>] = {};</div><div class="line">    <span class="keyword">if</span>(pattern[x][y] != <span class="string">'.'</span>)</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    X.push(x), Y.push(y);</div><div class="line">    used[x][y] = <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span>(!X.empty()) {</div><div class="line">        x = X.front(), X.pop();</div><div class="line">        y = Y.front(), Y.pop();</div><div class="line">        <span class="keyword">if</span>(x == <span class="number">0</span> || x == r-<span class="number">1</span> || y == <span class="number">0</span> || y == c-<span class="number">1</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) {</div><div class="line">            tx = x+dx[i], ty = y+dy[i];</div><div class="line">            <span class="keyword">if</span>(tx &lt; <span class="number">0</span> || ty &lt; <span class="number">0</span> || tx &gt;= r || ty &gt;= c)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">if</span>(used[tx][ty] == <span class="number">0</span> &amp;&amp; pattern[tx][ty] == <span class="string">'.'</span>) {</div><div class="line">                used[tx][ty] = <span class="number">1</span>;</div><div class="line">                X.push(tx), Y.push(ty);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> cond4(<span class="keyword">int</span> r, <span class="keyword">int</span> c) {</div><div class="line">    <span class="keyword">int</span> i, j;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; r-<span class="number">1</span>; i++) {</div><div class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; c-<span class="number">1</span>; j++) {</div><div class="line">            <span class="keyword">bool</span> flag = (pattern[i][j] == <span class="string">'.'</span> || pattern[i][j+<span class="number">1</span>] == <span class="string">'.'</span> ||</div><div class="line">                         pattern[i+<span class="number">1</span>][j] == <span class="string">'.'</span> || pattern[i+<span class="number">1</span>][j+<span class="number">1</span>] == <span class="string">'.'</span>);</div><div class="line">            <span class="keyword">if</span>(flag == <span class="keyword">false</span>)</div><div class="line">                <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">}</div><div class="line"><span class="keyword">int</span> main() {</div><div class="line">	<span class="comment">// freopen("in.txt", "r+t", stdin);</span></div><div class="line">	<span class="comment">// freopen("out.txt", "w+t", stdout); </span></div><div class="line">    <span class="keyword">int</span> testcase;</div><div class="line">    <span class="keyword">int</span> r, c, n;</div><div class="line">    <span class="keyword">int</span> x, y, v, i, j, k;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">    <span class="keyword">while</span>(testcase--) {</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;r, &amp;c, &amp;n) != <span class="number">3</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="built_in">memset</span>(g, <span class="number">0</span>, <span class="keyword">sizeof</span>(g));</div><div class="line">        <span class="built_in">memset</span>(ug, <span class="number">0</span>, <span class="keyword">sizeof</span>(ug));</div><div class="line">        <span class="keyword">int</span> tot = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++) {</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>, &amp;x, &amp;y, &amp;v);</div><div class="line">            g[x][y] = v;</div><div class="line">            ug[x][y] = <span class="number">1</span>;</div><div class="line">            tot += v;</div><div class="line">        }</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; r; i++)</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>, &amp;pattern[i]);</div><div class="line">        <span class="keyword">int</span> cellcnt = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> unshaded = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; r; i++)</div><div class="line">            <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; c; j++)</div><div class="line">                <span class="keyword">if</span>(pattern[i][j] == <span class="string">'#'</span>)</div><div class="line">                    cellcnt++, x = i, y = j;</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    unshaded++;</div><div class="line">        <span class="keyword">if</span>(tot != unshaded) {</div><div class="line">            <span class="built_in">puts</span>(<span class="string">"not solved"</span>);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">if</span>(cellcnt &amp;&amp; !cond1(x, y, r, c, cellcnt)) {</div><div class="line">            <span class="built_in">puts</span>(<span class="string">"not solved"</span>);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; r &amp;&amp; ret; i++) {</div><div class="line">            <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; c &amp;&amp; ret; j++) {</div><div class="line">                <span class="keyword">if</span>(ug[i][j]) {</div><div class="line">                    ret &amp;= cond2(i, j, r, c);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">if</span>(!ret) {</div><div class="line">            <span class="built_in">puts</span>(<span class="string">"not solved"</span>);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; r &amp;&amp; ret; i++) {</div><div class="line">            <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; c &amp;&amp; ret; j++) {</div><div class="line">                <span class="keyword">if</span>(ug[i][j]) {</div><div class="line">                    ret &amp;= cond3(i, j, r, c);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">if</span>(!ret) {</div><div class="line">            <span class="built_in">puts</span>(<span class="string">"not solved"</span>);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        }</div><div class="line">        ret &amp;= cond4(r, c);</div><div class="line">        <span class="keyword">if</span>(!ret) {</div><div class="line">            <span class="built_in">puts</span>(<span class="string">"not solved"</span>);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        }</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"solved"</span>);</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
    <article id="post-oj/uva/uva-12721" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/03/oj/uva/uva-12721/" class="article-date">
  <time datetime="2014-06-03T00:46:18.000Z" itemprop="datePublished">Jun 3 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/解題區/">解題區</a>►<a class="article-category-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a>
  </div>

  </div>
  <div class="article-inner ">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/03/oj/uva/uva-12721/">UVa 12721 - Cheap B-Subsequence</a>
    </h1>
  

      </header>
        
    <footer class="article-footer">
      <a data-url="http://morris821028.github.io/2014/06/03/oj/uva/uva-12721/" data-id="r3t80ule5m6pll50" class="article-share-link">Share</a>
      
        <a href="http://morris821028.github.io/2014/06/03/oj/uva/uva-12721/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dp/">dp</a></li></ul>

    </footer>
    <div class="article-entry article-index" itemprop="articleBody">
      
          
        
          <div class="toggle-content">
            <h2 id="Problem">Problem</h2>
<p>Some time ago, Dejan Stojanovic, a Serbian poet, said: “Words rich in meaning can be cheap in sound<br>effects.” Is it true? A String Processing professor at UFPE wants to test this quote with strings. For that, he defined what he calls a “cheap B-subsequence”. A cheap B-subsequence, according to his definition, is a subsequence of size B, of a string S(B &lt;= |S|), that has the lowest associated cost. To define the cost of a string, the professor determined a series of rules to each letter of the alphabet. The alphabet that he used contains only lowercase letters. The rule of a letter is defined as a set of pairs (P<sub>i</sub>, C<sub>i</sub>), which indicates that if this letter appears in a position X on the subsequence, where X is a multiple of P<sub>i</sub>, then the cost of (X/P<sub>i</sub>) * C<sub>i</sub> will be added to the total cost of this subsequence. Let’s show an example. Suppose we have the following rules:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[a] = <span class="list">{(2, 3), (4, 10)}</span></div><div class="line">[b] = <span class="list">{(1, 4), (7, 50)}</span></div><div class="line">[c] = <span class="list">{(1, 2), (4, 20)}</span></div><div class="line">[d..z] = <span class="list">{ }</span> // there are no rules for the characters `d` to `z`</div></pre></td></tr></table></figure>

<p>Suppose we have the string <code>abaabcbc</code>, and B = 4. If we choose the subsequence <code>aabc</code> (abaabcbc), we would do the following procedure to calculate the associated cost:</p>
<ol>
<li><p>The first letter of the sequence is an <code>a</code>, and the position 1 is neither multiple of 2 or 4, so the cost is <code>0</code>;</p>
</li>
<li><p>The second letter of the sequence is another <code>a</code>, and the position 2 is a multiple of 2, so we’ll add the cost of <code>(2/2) * 3 = 3</code>;</p>
</li>
<li>The third letter of the sequence is a <code>b</code>, and the position 3 is multiple of 1, so we will add the cost of <code>(3/1) * 4 = 12</code>;</li>
<li>The last letter of the sequence is a <code>c</code>, and the position 4 is a multiple of 1 and 4, so we will add<br>the cost of <code>(4/1) * 2 + (4/4)* 20 = 28</code>.</li>
</ol>
<p>The total associated cost to this subsequence is 43, which is not the lowest cost, since we could have chosen aaab (abaabcbc) and obtained an associated cost of 19 | this is indeed the cost of the cheap B-subsequence. Given the string S and the integer B, and the rules of the alphabet, your task is to create a program that tells the professor the cost of the cheap B-subsequence.</p>
<h2 id="Input">Input</h2>
<p>The first line contains T (T &lt; 100)－　the number of test cases, after this line T test cases follows. The first line of a test case contains a string S of lowercase letters and an integer B<br>(1 &lt;= B &lt;= |S| &lt;= 100). Each of the next 26 lines describe the rule of each letter. The first of the 26 lines corresponds to the rule of the letter <code>a</code>; the following line corresponds to the rule of the letter <code>b</code>; the last of the 26 lines corresponds to the rule of the letter <code>z</code>. Each line containing a rule is described in the following way: </p>
<p>Q, P1, C1, P2, C2, … PQ, CQ</p>
<p>(1 &lt;= Q &lt;= 10; 1 &lt;= Pi &lt;= |S|; 1 &lt;= Ci &lt;= 50), where Q is the amount of pairs associated to this rule, and is followed by the pairs themselves.</p>
<h2 id="Output">Output</h2>
<p>For each test case print a line containing <code>Case #X: Y</code>, where X is the case number, starting at 1, and Y is the cost of the cheap B-subsequence.</p>
<h2 id="Sample_Input">Sample Input</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="number">2</span></div><div class="line">abcd <span class="number">1</span></div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">20</span></div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">15</span></div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">8</span></div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">30</span></div><div class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">0</span> (<span class="number">21</span> <span class="keyword">lines</span>)</div><div class="line">abaabcbc <span class="number">4</span></div><div class="line"><span class="number">2</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">10</span></div><div class="line"><span class="number">2</span> <span class="number">1</span> <span class="number">4</span> <span class="number">7</span> <span class="number">50</span></div><div class="line"><span class="number">2</span> <span class="number">1</span> <span class="number">2</span> <span class="number">4</span> <span class="number">20</span></div><div class="line"><span class="number">0</span> (<span class="number">23</span> <span class="keyword">lines</span>)</div></pre></td></tr></table></figure>

<h2 id="Sample_Output">Sample Output</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Case</span> <span class="comment">#1: 8</span></div><div class="line"><span class="keyword">Case</span> <span class="comment">#2: 19</span></div></pre></td></tr></table></figure>

<h2 id="Solution">Solution</h2>
<p><strong> 題目描述： </strong></p>
<p>找一個長度為 <code>B</code> 的 subsequence，並且每一個字符成本如題目所定義，求最小構成成本。</p>
<p><strong> 題目解法： </strong></p>
<p>動態規劃，狀態 dp[length][subsequence_index]</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#<span class="keyword">include</span> &lt;algorithm&gt;</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> dp[<span class="number">128</span>][<span class="number">128</span>], cost[<span class="number">26</span>][<span class="number">128</span>];</div><div class="line"><span class="keyword">int</span> main() {</div><div class="line">	<span class="keyword">int</span> testcase, cases = <span class="number">0</span>;</div><div class="line">	<span class="keyword">char</span> S[<span class="number">128</span>];</div><div class="line">	<span class="keyword">int</span> B, P, C, N, M;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;testcase);</div><div class="line">	<span class="keyword">while</span>(testcase--) {		</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%s %d"</span>, S+<span class="number">1</span>, &amp;B);</div><div class="line">		</div><div class="line">		N = <span class="built_in">strlen</span>(S+<span class="number">1</span>);</div><div class="line">		<span class="built_in">memset</span>(dp, <span class="number">0x3f</span>, <span class="keyword">sizeof</span>(dp));</div><div class="line">		<span class="built_in">memset</span>(cost, <span class="number">0</span>, <span class="keyword">sizeof</span>(cost));</div><div class="line">		</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) {</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;M);</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j++) {</div><div class="line">				<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;P, &amp;C);</div><div class="line">				<span class="keyword">int</span> oP = P;</div><div class="line">				<span class="keyword">while</span>(oP &lt;= N)</div><div class="line">					cost[i][oP] += oP / P * C, oP += P;</div><div class="line">			}</div><div class="line">		}		</div><div class="line"></div><div class="line">		dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; B; i++) {</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= N; j++) {</div><div class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> k = j + <span class="number">1</span>; k &lt;= N; k++) {</div><div class="line">					<span class="keyword">int</span> c = cost[S[k] - <span class="string">'a'</span>][i + <span class="number">1</span>];</div><div class="line">					dp[i+<span class="number">1</span>][k] = min(dp[i+<span class="number">1</span>][k], dp[i][j] + c);</div><div class="line">				}</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="keyword">int</span> ret = <span class="number">0x3f3f3f3f</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++)</div><div class="line">			ret = min(ret, dp[B][i]);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"Case #%d: %d\n"</span>, ++cases, ret);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"><span class="comment">/*</span></div><div class="line">2</div><div class="line">abcd 1</div><div class="line">1 1 20</div><div class="line">1 1 15</div><div class="line">1 1 8</div><div class="line">1 1 30</div><div class="line">1 1 2</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line"></div><div class="line">abaabcbc 4</div><div class="line">2 2 3 4 10</div><div class="line">2 1 4 7 50</div><div class="line">2 1 2 4 20</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line">0</div><div class="line"></div><div class="line">*/</div></pre></td></tr></table></figure>
          </div>
          <div class="toggle-input article-more-link"><a>Read More +</a></div>
        
      
    </div>

  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/categories/解題區/page/40/">&laquo; Prev</a><a class="page-number" href="/categories/解題區/">1</a><span class="space">&hellip;</span><a class="page-number" href="/categories/解題區/page/39/">39</a><a class="page-number" href="/categories/解題區/page/40/">40</a><span class="page-number current">41</span><a class="page-number" href="/categories/解題區/page/42/">42</a><a class="page-number" href="/categories/解題區/page/43/">43</a><span class="space">&hellip;</span><a class="page-number" href="/categories/解題區/page/45/">45</a><a class="extend next" rel="next" href="/categories/解題區/page/42/">Next &raquo;</a>
    </nav>
  
</section>
          
            <aside id="sidebar">
  <div id="ukagaka_panel"></div>

  

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/">學校課程</a><span class="category-list-count">46</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/作業系統/">作業系統</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/大學專題/">大學專題</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/巨量資料/">巨量資料</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/敏捷方法/">敏捷方法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/編譯器/">編譯器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/自然語言/">自然語言</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算型智慧/">計算型智慧</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/計算幾何/">計算幾何</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資料庫系統/">資料庫系統</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/資訊安全/">資訊安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/學校課程/通識課程/">通識課程</a><span class="category-list-count">14</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/手札日記/">手札日記</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/">網頁設計</a><span class="category-list-count">14</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/About-This-Blog/">About This Blog</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/JQuery/">JQuery</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/Markdown/">Markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/網頁設計/NodeJs/">NodeJs</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/">解題區</a><span class="category-list-count">449</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/Latex/">Latex</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/出題解題/">出題解題</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-POJ/">解題區 - POJ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-UVa/">解題區 - UVa</a><span class="category-list-count">409</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-Zerojudge/">解題區 - Zerojudge</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-其他題目/">解題區 - 其他題目</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解題區/解題區-未解題目/">解題區 - 未解題目</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/雜言筆記/">雜言筆記</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a class="text" href="/2015/04/20/2015-google-code-jam-1A/">
              
                <i class="icon-file-o"></i> 
              
            2015 Google Code Jam Round 1A</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1115/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1115 - Water Shortage</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1089/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1089 - Suffix-Replacement Grammars</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1084/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1084 - Deer-Proof Fence</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1080/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1080 - My Bad</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1078/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1078 - Steam Roller</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1076/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1076 - Password Suspects</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1063/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1063 - Marble Game</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1049/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1049 - Remember the A La Mode</a>
          </li>
        
          <li>
            <a class="text" href="/2015/04/20/uva-1048/">
              
                <i class="icon-file-o"></i> 
              
            UVa 1048 - Low Cost Air Travel</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget widget-background1">   
      	<ul>
	      <li><a href="http://mypaper.pchome.com.tw/zerojudge" target="_blank" title="Old Blog"><i class="icon-star"></i> Morris' Blog (pchome)</a></li>
	      <li><a href="http://flere114.blogspot.tw/" target="_blank" title="蘿莉勿觸"><i class="icon-googles"></i> flere's Blog</a></li>
	      <li><a href="http://dreamoon4.blogspot.tw/" target="_blank" title="夢月"><i class="icon-googles"></i> dreamoon's Blog</a></li>
	      <li><a href="http://m80126colin.github.io" target="_blank" title="許胖們"><i class="icon-github-alt"></i> m80126colin's Blog</a></li>
	      <li><a href="http://sd12582000.blogspot.tw/" target="_blank" title="妮可妮神"><i class="icon-github-alt"></i> Nico's Blog</a></li>
	      <li><a href="http://kuoe0.logdown.com/" target="_blank" title="郭至軒大神"><i class="icon-github-alt"></i> KuoE0's Dots</a></li>
	      <li><a href="#" title=""><i class="icon-github-alt"></i> Can you translate world for me ?</a></li>
    	</ul>
    </div>
</div>

  
    
<script src="/js/jquery-ui.js"></script>
<script src="/js/ukagaka/jquery.morris.ukagaka.resource.js"></script>
<script src="/js/ukagaka/typed.js"></script>
<script type="text/javascript">
  $('#ukagaka_panel').ukagaka();
</script>
  
</aside>

          
            
        
      </div>
      <footer id="footer">
  
  <div class="outer">    
    <div class="social-group">
      
      <a href="https://github.com/morris821028" target="_blank" title="github"><i class="icon-github"></i></a>
      
      
      <a href="https://plus.google.com/u/0/108158678174364359204" target="_blank" title="Google+"><i class="icon-google-plus-sign"></i></a>
      
      
      <a href="https://www.facebook.com/Morris1028" target="_blank" title="facebook"><i class="icon-facebook-sign"></i></a>
      
      
      <a href="http://uhunt.felix-halim.net/id/46705" target="_blank" title="uhunt" ><span class="icon-uhunt">UVa<span></a>
      
    </div>
    <div id="footer-info" class="inner">
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/morris821028/hexo-theme-landscape" target="_blank" title="landscape">landscape</a> &copy; 2015 Shiang-Yun Yang 
    </div>  

  </div>
</footer>


    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/picture" class="mobile-nav-link">Pictures</a>
  
    <a href="/works" class="mobile-nav-link">Works</a>
  
</nav>
    
<script>
  var disqus_shortname = 'morris1028';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/jquery.lazyload.js" type="text/javascript"></script>

<script src="/js/jquery.als-1.6.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>